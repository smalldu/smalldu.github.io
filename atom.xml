<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>大石头布 的技术blog</title>
  <subtitle>努力的人运气总不会太差</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2016-08-21T02:22:40.780Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>大石头布</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>SalesForce 学习目录及语法速查</title>
    <link href="http://yoursite.com/2016/08/21/SalesForce-%E5%AD%A6%E4%B9%A0%E7%9B%AE%E5%BD%95%E5%8F%8A%E8%AF%AD%E6%B3%95%E9%80%9F%E6%9F%A5/"/>
    <id>http://yoursite.com/2016/08/21/SalesForce-学习目录及语法速查/</id>
    <published>2016-08-21T02:15:14.000Z</published>
    <updated>2016-08-21T02:22:40.780Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>以下是本人整理的一些SalesForce学习目录，感谢作者的分享</p>
</blockquote>
<ul>
<li><a href="http://www.cnblogs.com/zitjubiz/p/an-architects-guide-to-the-salesforce.html" target="_blank" rel="external">SalesForce 入门,大概了解的文章</a></li>
<li><a href="http://blog.csdn.net/tiger00598/article/details/5731572" target="_blank" rel="external">基础语法篇</a><a id="more"></a></li>
<li><a href="http://blog.csdn.net/tiger00598/article/details/5770792" target="_blank" rel="external">salesforce.com Apex语言介绍(二)</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5278303.html" target="_blank" rel="external">salesforce 零基础开发入门学习（二）变量基础知识，集合，表达式，流程控制语句</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5283611.html" target="_blank" rel="external">salesforce 零基础开发入门学习（三）sObject简单介绍以及简单DML操作（SOQL</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5284479.html" target="_blank" rel="external">salesforce 零基础开发入门学习（四）多表关联下的SOQL以及表字段Data type详解</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5287343.html" target="_blank" rel="external">salesforce 零基础开发入门学习（五）异步进程介绍与数据批处理Batchable</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5302940.html" target="_blank" rel="external">salesforce 零基础开发入门学习（六）简单的数据增删改查页面的构建</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5327416.html" target="_blank" rel="external">salesforce 零基础开发入门学习（七）PickList的value值获取</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5343287.html" target="_blank" rel="external">salesforce 零基础开发入门学习（八）数据分页简单制作</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5344278.html" target="_blank" rel="external">salesforce 零基础开发入门学习（九）Approval Process 介绍</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5359762.html" target="_blank" rel="external">salesforce 零基础开发入门学习（十）IDE便捷小知识</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5344809.html" target="_blank" rel="external">salesforce 零基础开发入门学习（十一）sObject及Schema深入</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5369089.html" target="_blank" rel="external">salesforce 零基础开发入门学习（十二）with sharing 、without sharing 、无声明区别</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5372117.html" target="_blank" rel="external">salesforce 零基础开发入门学习（十三）salesforce中JSON的使用</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5381289.html" target="_blank" rel="external">salesforce 零基础开发入门学习（十四）salesforce中工厂模式的运用</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5394542.html" target="_blank" rel="external">salesforce 零基础开发入门学习（十五）salesforce中formula的使用（不含Date/Time）</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5409209.html" target="_blank" rel="external">salesforce 零基础学习（十六）Validation Rules &amp; Date/time</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5413731.html" target="_blank" rel="external">salesforce 零基础学习（十七）Trigger用法</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5416842.html" target="_blank" rel="external">salesforce 零基础学习（十八）WorkFlow介绍及用法</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5406352.html" target="_blank" rel="external">salesforce 零基础学习（十九）Permission sets 讲解及设置</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5433849.html" target="_blank" rel="external">salesforce 零基础学习（二十）简单APP制作</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5445174.html" target="_blank" rel="external">salesforce 零基础学习（二十一）workflow Q&amp;A</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5474874.html" target="_blank" rel="external">salesforce 零基础学习（二十二）Test简单使用</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5507940.html" target="_blank" rel="external">salesforce 零基础学习（二十三）数据记录导出至excel（自定义报表导出）</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5542620.html" target="_blank" rel="external">salesforce 零基础学习（二十四）解析csv格式内容</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5544858.html" target="_blank" rel="external">salesforce 零基础学习（二十五）PickList简单联动操作</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5546735.html" target="_blank" rel="external">salesforce 零基础学习（二十六）自定义图表chart简单介绍（使用apex和VF实现）</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5553617.html" target="_blank" rel="external">salesforce 零基础学习（二十七）VF页面等待（loading）效果制作</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5563278.html" target="_blank" rel="external">salesforce 零基础学习（二十八）使用ajax方式实现联动</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5577281.html" target="_blank" rel="external">salesforce 零基础学习（二十九）Record Types简单介绍</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5590066.html" target="_blank" rel="external">salesforce 零基础学习（三十）工具篇：Debug Log小工具</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5591503.html" target="_blank" rel="external">salesforce 零基础学习（三十一）关于LookUp字段点击Save时的Validation</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5601158.html" target="_blank" rel="external">salesforce 零基础学习（三十二）通过Streams和DOM方式读写XML</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5599632.html" target="_blank" rel="external">salesforce 零基础学习（三十三）通过REST方式访问外部数据以及JAVA通过rest方式访问salesforce</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5619655.html" target="_blank" rel="external">salesforce 零基础学习（三十四）动态的Custom Label</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5624365.html" target="_blank" rel="external">salesforce 零基础学习（三十五) 通过Process Builder和Approval Processes锁定记录(Lock Record)</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5627563.html" target="_blank" rel="external">salesforce 零基础学习（三十六)通过Process Builder以及Apex代码实现锁定记录( Lock Record)</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5660131.html" target="_blank" rel="external">salesforce 零基础学习（三十七） DML及Database方法简单描述</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5684134.html" target="_blank" rel="external">salesforce 零基础学习（三十八）Translate 的使用(国际化处理)</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5680446.html" target="_blank" rel="external">salesforce 零基础学习（三十九） soql函数以及常量</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5706758.html" target="_blank" rel="external">salesforce 零基础学习（四十）Custom Settings简单使用</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5723939.html" target="_blank" rel="external">salesforce 零基础学习（四十一）Group</a></li>
<li><a href="http://www.cnblogs.com/zero-zyq/p/5752978.html" target="_blank" rel="external">salesforce 零基础学习（四十二）简单文件上传下载</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;以下是本人整理的一些SalesForce学习目录，感谢作者的分享&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.cnblogs.com/zitjubiz/p/an-architects-guide-to-the-salesforce.html&quot;&gt;SalesForce 入门,大概了解的文章&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/tiger00598/article/details/5731572&quot;&gt;基础语法篇&lt;/a&gt;
    
    </summary>
    
      <category term="SalesForce" scheme="http://yoursite.com/categories/SalesForce/"/>
    
    
      <category term="SalesForce" scheme="http://yoursite.com/tags/SalesForce/"/>
    
  </entry>
  
  <entry>
    <title>Swift AVPlayer 播放网络视频之基础篇 </title>
    <link href="http://yoursite.com/2016/08/20/Swift-AVPlayer-%E6%92%AD%E6%94%BE%E7%BD%91%E7%BB%9C%E8%A7%86%E9%A2%91%E4%B9%8B%E5%9F%BA%E7%A1%80%E7%AF%87/"/>
    <id>http://yoursite.com/2016/08/20/Swift-AVPlayer-播放网络视频之基础篇/</id>
    <published>2016-08-20T06:01:51.000Z</published>
    <updated>2016-08-20T06:13:57.690Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/954071-f0f25ee81a868945.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="本篇效果图"><br><a id="more"></a><br><img src="http://upload-images.jianshu.io/upload_images/954071-bfeede1f922ca47b.gif?imageMogr2/auto-orient/strip" alt="效果"></p>
<p>iOS 播放视频可以用<code>MPMoviePlayerController</code>，<code>MPMoviePlayerController</code>是系统高度封装的VC，使用起来相对简单，但是灵活性缺失，<br>一般播放视频会选择使用<code>AVPlayer</code> ， 它可以高度自定义。虽说 <code>AVPlayer</code> 也有一些库，如果项目比较紧可以用第三方，但是如果有时间还是要自己学习的。本篇以<code>AVPlayer</code>播放网络视频为例，介绍 <code>AVPlayer</code>的基本用法。后面慢慢重构，尽量写出一个功能强大的播放器。</p>
<h5 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h5><p>找到Info.plist 右键 Open As -&gt; Source Code  , 在 <code>&lt;/dict&gt;</code> 上面加上：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>NSAppTransportSecurity<span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dict</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>NSAllowsArbitraryLoads<span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">true</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>不加的不能处理http请求。都懂的。</p>
<h5 id="加载出视频"><a href="#加载出视频" class="headerlink" title="加载出视频"></a>加载出视频</h5><p>首先来介绍用到的几个对象：</p>
<ul>
<li><code>AVPlayerItem</code> 一个媒体资源管理对象，管理者视频的一些基本信息和状态，如 播放进度、缓存进度等 。 一个AVPlayerItem对应着一个视频资源。</li>
<li><code>AVPlayer</code> 视频操作对象，但是无法显示视频，需要把自己添加到一个<code>AVPlayerLayer</code> 上</li>
<li><code>AVPlayerLayer</code> 用来显示视频的</li>
</ul>
<p>我们先来自定义一个 <code>ZZPlayerView</code> 继承自 <code>UIView</code>  ， 这个 View 是用来显示视频和处理一些基本操作的。</p>
<p>1、添加一个变量 <code>var playerLayer:AVPlayerLayer?</code><br>2、在<code>layoutSubviews</code> 方法中指定layer的大小 </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutSubviews</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">super</span>.layoutSubviews()</div><div class="line">    playerLayer?.frame = <span class="keyword">self</span>.bounds</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在<code>Main.stroyboard</code> 中拖一个<code>UIView</code> 到VC上 ， 把 <code>Class</code> 设置成<code>ZZPlayerView</code> . </p>
<p>然后在VC中声明几个对象 :<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> playerView:<span class="type">ZZPlayerView</span>!</div><div class="line">    </div><div class="line"><span class="keyword">var</span> playerItem:<span class="type">AVPlayerItem</span>!</div><div class="line"><span class="keyword">var</span> avplayer:<span class="type">AVPlayer</span>!  </div><div class="line"><span class="keyword">var</span> playerLayer:<span class="type">AVPlayerLayer</span>!</div></pre></td></tr></table></figure></p>
<p>上面提到的三个对象和自定义的View 。 </p>
<p>然后<code>ViewDidLoad</code>中 添加如下代码 ： </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 检测连接是否存在 不存在报错</span></div><div class="line"><span class="keyword">guard</span> <span class="keyword">let</span> url = <span class="type">NSURL</span>(string: <span class="string">"http://bos.nj.bpc.baidu.com/tieba-smallvideo/11772_3c435014fb2dd9a5fd56a57cc369f6a0.mp4"</span>) <span class="keyword">else</span> &#123; <span class="built_in">fatalError</span>(<span class="string">"连接错误"</span>) &#125;</div><div class="line">       </div><div class="line">playerItem = <span class="type">AVPlayerItem</span>(<span class="type">URL</span>: url) <span class="comment">// 创建视频资源 </span></div><div class="line"><span class="comment">// 监听缓冲进度改变</span></div><div class="line">playerItem.addObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">"loadedTimeRanges"</span>, options: <span class="type">NSKeyValueObservingOptions</span>.<span class="type">New</span>, context: <span class="literal">nil</span>)</div><div class="line"><span class="comment">// 监听状态改变</span></div><div class="line">playerItem.addObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">"status"</span>, options: <span class="type">NSKeyValueObservingOptions</span>.<span class="type">New</span>, context: <span class="literal">nil</span>)</div><div class="line"><span class="comment">// 将视频资源赋值给视频播放对象</span></div><div class="line"><span class="keyword">self</span>.avplayer = <span class="type">AVPlayer</span>(playerItem: playerItem)</div><div class="line"><span class="comment">// 初始化视频显示layer</span></div><div class="line">playerLayer = <span class="type">AVPlayerLayer</span>(player: avplayer)</div><div class="line"><span class="comment">// 设置显示模式</span></div><div class="line">playerLayer.videoGravity = <span class="type">AVLayerVideoGravityResizeAspect</span></div><div class="line">playerLayer.contentsScale = <span class="type">UIScreen</span>.mainScreen().scale</div><div class="line"><span class="comment">// 赋值给自定义的View</span></div><div class="line"><span class="keyword">self</span>.playerView.playerLayer = <span class="keyword">self</span>.playerLayer</div><div class="line"><span class="comment">// 位置放在最底下</span></div><div class="line"><span class="keyword">self</span>.playerView.layer.insertSublayer(playerLayer, atIndex: <span class="number">0</span>)</div></pre></td></tr></table></figure>
<p>上面加了监听记得在页面销毁的时候<code>remove</code>掉 :<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">deinit</span>&#123;</div><div class="line">    playerItem.removeObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">"loadedTimeRanges"</span>)</div><div class="line">    playerItem.removeObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">"status"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后处理监听事件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">override func observeValueForKeyPath(keyPath: String?, ofObject object: AnyObject?, change: [String : AnyObject]?, context: UnsafeMutablePointer&lt;Void&gt;) &#123;</div><div class="line">    guard let playerItem = object as? AVPlayerItem else &#123; return &#125;</div><div class="line">    if keyPath == &quot;loadedTimeRanges&quot;&#123;</div><div class="line">        // 缓冲进度 暂时不处理</div><div class="line">    &#125;else if keyPath == &quot;status&quot;&#123;</div><div class="line">        // 监听状态改变 </div><div class="line">        if playerItem.status == AVPlayerItemStatus.ReadyToPlay&#123;</div><div class="line">            // 只有在这个状态下才能播放</div><div class="line">            self.avplayer.play()</div><div class="line">        &#125;else&#123;</div><div class="line">            print(&quot;加载异常&quot;)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>一共有三种状态  <code>Unknown</code> 、<code>ReadyToPlay</code> 、 <code>Failed</code> 只有在 <code>ReadyToPlay</code> 状态下视频才能播放。</p>
</blockquote>
<p>好了  运行视频，如果一切正常的话（一般没问题）。视频可以正常播放出来的。网络加载的，网速慢的 等等。</p>
<h5 id="时间显示"><a href="#时间显示" class="headerlink" title="时间显示"></a>时间显示</h5><p>没见过哪个视频播放器是光秃秃的，啥都没有， 没有进度条 、没有时间显示 。我们先给播放器加上时间显示 。<br>我们的布局最好使用<code>AutoLayout</code> , 因为视频一般是支持横竖屏的，<code>AutoLayout</code> 会省去你很多麻烦， 代码写<code>Autolayout</code> 比较麻烦，所以这里选用了<code>SnapKit</code><br>, 一个<code>AutoLayout</code> 的库， 使<code>AutoLayout</code>在代码中的使用语法异常简洁.为了简单，我直接将源码拖到工程目录下使用了。下载地址 ： <a href="https://github.com/SnapKit/SnapKit" target="_blank" rel="external">SnapKit</a> </p>
<p>因为我们这里使用了<code>storyboard</code> 创建的<code>ZZPlayerView</code> , 所以要手动添加View的话，需要在 <code>awakeFromNib</code>方法中处理 </p>
<p>在<code>ZZPlayerView</code> 中声明变量 <code>var timeLabel:UILabel!</code> .<br>然后在 <code>awakeFromNib</code> 中布局它的位置。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"> timeLabel = <span class="type">UILabel</span>()</div><div class="line">timeLabel.textColor = <span class="type">UIColor</span>.whiteColor()</div><div class="line">timeLabel.font = <span class="type">UIFont</span>.systemFontOfSize(<span class="number">12</span>)</div><div class="line"><span class="keyword">self</span>.addSubview(timeLabel)</div><div class="line">timeLabel.snp_makeConstraints &#123; (make) <span class="keyword">in</span></div><div class="line">    make.<span class="keyword">right</span>.equalTo(<span class="keyword">self</span>)</div><div class="line">    make.bottom.equalTo(<span class="keyword">self</span>).inset(<span class="number">5</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后回到<code>ViewController</code>中，写一个将秒转成时间字符串的方法，因为我们将得到秒。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">formatPlayTime</span><span class="params">(secounds:NSTimeInterval)</span></span>-&gt;<span class="type">String</span>&#123;</div><div class="line">    <span class="keyword">if</span> secounds.isNaN&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"00:00"</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">let</span> <span class="type">Min</span> = <span class="type">Int</span>(secounds / <span class="number">60</span>)</div><div class="line">    <span class="keyword">let</span> <span class="type">Sec</span> = <span class="type">Int</span>(secounds % <span class="number">60</span>)</div><div class="line">    <span class="keyword">return</span> <span class="type">String</span>(format: <span class="string">"%02d:%02d"</span>, <span class="type">Min</span>, <span class="type">Sec</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>因为在刚开始的时候我们可能得到的不是一个数字，所以加上了判断 。</p>
<p>因为我们要实时计算时间，这里加上一个计时器。一般会选择<code>NSTimer</code> , 但是这里我们选择<code>CADisplayLink</code> .<br>声明一个变量 <code>var link:CADisplayLink!</code></p>
<p>在<code>viewDidLoad</code>最底下加两句话 。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.link = <span class="type">CADisplayLink</span>(target: <span class="keyword">self</span>, selector: #selector(update))</div><div class="line"><span class="keyword">self</span>.link.addToRunLoop( <span class="type">NSRunLoop</span>.mainRunLoop(), forMode: <span class="type">NSDefaultRunLoopMode</span>)</div></pre></td></tr></table></figure>
<p><code>CADisplayLink</code> 的执行次数相当于屏幕的帧数，<code>iPhone</code> 不卡顿的时候是每秒60次。把它加入主loop中，默认Mode 。 关于<code>NSRunLoop</code> 又是一个大话题，感兴趣的，以后一起讨论。这里先这么写着。差不多每秒执行60次。</p>
<p>然后我们来处理这个<code>update</code> 方法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">update</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="comment">// 当前播放到的时间</span></div><div class="line">    <span class="keyword">let</span> currentTime = <span class="type">CMTimeGetSeconds</span>(<span class="keyword">self</span>.avplayer.currentTime())</div><div class="line">    <span class="comment">// 总时间</span></div><div class="line">    <span class="keyword">let</span> totalTime   = <span class="type">NSTimeInterval</span>(playerItem.duration.value) / <span class="type">NSTimeInterval</span>(playerItem.duration.timescale)</div><div class="line">    <span class="comment">// timescale 这里表示压缩比例</span></div><div class="line">    <span class="keyword">let</span> timeStr = <span class="string">"<span class="subst">\(formatPlayTime(currentTime)</span>)/<span class="subst">\(formatPlayTime(totalTime)</span>)"</span> <span class="comment">// 拼接字符串</span></div><div class="line">    playerView.timeLabel.text = timeStr <span class="comment">// 赋值</span></div><div class="line">    <span class="comment">// <span class="doctag">TODO:</span> 播放进度 </span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在执行。是不是可以实时显示时间了。</p>
<h5 id="处理进度条"><a href="#处理进度条" class="headerlink" title="处理进度条"></a>处理进度条</h5><p>进度条我们使用<code>UISlider</code> + <code>UIProgressView</code>的方式。</p>
<p>首先在<code>ZZPlayerView</code>添加一个<code>UISlider</code>。声明变量<code>var slider:UISlider!</code>。<br><code>awakeFromNib</code> 中加入以下代码：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">slider = <span class="type">UISlider</span>()</div><div class="line"><span class="keyword">self</span>.addSubview(slider)</div><div class="line">slider.snp_makeConstraints &#123; (make) <span class="keyword">in</span></div><div class="line">    make.bottom.equalTo(<span class="keyword">self</span>).inset(<span class="number">5</span>)</div><div class="line">    make.<span class="keyword">left</span>.equalTo(<span class="keyword">self</span>).offset(<span class="number">50</span>)</div><div class="line">    make.<span class="keyword">right</span>.equalTo(<span class="keyword">self</span>).inset(<span class="number">100</span>)</div><div class="line">    make.height.equalTo(<span class="number">15</span>)</div><div class="line">&#125;</div><div class="line">slider.minimumValue = <span class="number">0</span></div><div class="line">slider.maximumValue = <span class="number">1</span></div><div class="line">slider.value = <span class="number">0</span></div><div class="line"><span class="comment">// 从最大值滑向最小值时杆的颜色</span></div><div class="line">slider.maximumTrackTintColor = <span class="type">UIColor</span>.clearColor()</div><div class="line"><span class="comment">// 从最小值滑向最大值时杆的颜色</span></div><div class="line">slider.minimumTrackTintColor = <span class="type">UIColor</span>.whiteColor()</div><div class="line"><span class="comment">// 在滑块圆按钮添加图片</span></div><div class="line">slider.setThumbImage(<span class="type">UIImage</span>(named:<span class="string">"slider_thumb"</span>), forState: <span class="type">UIControlState</span>.<span class="type">Normal</span>)</div></pre></td></tr></table></figure>
<p>我们指定了slider的位置，并指定了最大值和最小值。当前值，还有更换了滑块的图片，系统的太丑了。</p>
<p>然后在<code>update</code>方法后面加上下面一句话，就可以看到播放进度了 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">self.playerView.slider.value = Float(currentTime/totalTime)</div></pre></td></tr></table></figure>
<p>运行下， 不错确实有效果。 而且滑块还不错 。（ 如果你替换了个不错的图片的话 ，你也可以下载我的项目，使用我的图片。我这边图片是用<code>Sketch</code> 随便画的  ） </p>
<p>这时候手动滑动滑块并没有用，会立刻回去。我们还需要处理滑块事件，改变视频播放进度。只需要处理两个事件 </p>
<p>在<code>ZZPlayerView</code>的<code>awakeFromNib</code>最底下加上以下代码：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 按下的时候</span></div><div class="line">slider.addTarget(<span class="keyword">self</span>, action: #selector(sliderTouchDown( <span class="number">_</span>:)), forControlEvents: <span class="type">UIControlEvents</span>.<span class="type">TouchDown</span>)</div><div class="line"><span class="comment">// 弹起的时候</span></div><div class="line">slider.addTarget(<span class="keyword">self</span>, action: #selector(sliderTouchUpOut( <span class="number">_</span>:)), forControlEvents: <span class="type">UIControlEvents</span>.<span class="type">TouchUpOutside</span>)</div><div class="line">slider.addTarget(<span class="keyword">self</span>, action: #selector(sliderTouchUpOut( <span class="number">_</span>:)), forControlEvents: <span class="type">UIControlEvents</span>.<span class="type">TouchUpInside</span>)</div><div class="line">slider.addTarget(<span class="keyword">self</span>, action: #selector(sliderTouchUpOut( <span class="number">_</span>:)), forControlEvents: <span class="type">UIControlEvents</span>.<span class="type">TouchCancel</span>)</div></pre></td></tr></table></figure></p>
<p>为了保险，我们在弹起的时候监听了三个方法。</p>
<p>因为我们不希望我们在滑动的时候还一直改变播放进度，所以在<code>ZZPlayerView</code> 加上变量<code>var sliding = false</code> 表示是否正在滑动</p>
<p>然后处理按下和弹起事件：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">sliderTouchDown</span><span class="params">(slider:UISlider)</span></span>&#123;</div><div class="line">    <span class="keyword">self</span>.sliding = <span class="literal">true</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">sliderTouchUpOut</span><span class="params">(slider:UISlider)</span></span>&#123;</div><div class="line">    <span class="comment">// <span class="doctag">TODO:</span> -代理处理</span></div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在<code>update</code> 方法中修改处理播放进度的逻辑</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 滑动不在滑动的时候</span></div><div class="line"><span class="keyword">if</span> !<span class="keyword">self</span>.playerView.sliding&#123;</div><div class="line">    <span class="comment">// 播放进度</span></div><div class="line">    <span class="keyword">self</span>.playerView.slider.value = <span class="type">Float</span>(currentTime/totalTime)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>滑动结束的时候需要改变视频进度，所以这里写一个代理。<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ZZPlayerViewDelegate</span>:<span class="title">NSObjectProtocol</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">zzplayer</span><span class="params">(playerView:ZZPlayerView,sliderTouchUpOut slider:UISlider)</span></span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>ZZPlayerView</code> 中声明 <code>weak var delegate:ZZPlayerViewDelegate?</code> </p>
<p>然后弹起事件中加入：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">delegate?.zzplayer(<span class="keyword">self</span>, sliderTouchUpOut: slider)</div></pre></td></tr></table></figure></p>
<p>然后在VC中实现代理：（别忘记在<code>viewDidLoad</code>中加上<code>self.playerView.delegate = self</code>）</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewController</span>:<span class="title">ZZPlayerViewDelegate</span></span>&#123;</div><div class="line">    <span class="comment">// 滑动滑块 指定播放位置</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">zzplayer</span><span class="params">(playerView: ZZPlayerView, sliderTouchUpOut slider: UISlider)</span></span> &#123;</div><div class="line">        </div><div class="line">        <span class="comment">//当视频状态为AVPlayerStatusReadyToPlay时才处理</span></div><div class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.avplayer.status == <span class="type">AVPlayerStatus</span>.<span class="type">ReadyToPlay</span>&#123;</div><div class="line">            <span class="keyword">let</span> duration = slider.value * <span class="type">Float</span>(<span class="type">CMTimeGetSeconds</span>(<span class="keyword">self</span>.avplayer.currentItem!.duration))</div><div class="line">            <span class="keyword">let</span> seekTime = <span class="type">CMTimeMake</span>(<span class="type">Int64</span>(duration), <span class="number">1</span>)</div><div class="line">            <span class="comment">// 指定视频位置</span></div><div class="line">            <span class="keyword">self</span>.avplayer.seekToTime(seekTime, completionHandler: &#123; (b) <span class="keyword">in</span></div><div class="line">                <span class="comment">// 别忘记改状态</span></div><div class="line">                playerView.sliding = <span class="literal">false</span></div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这时候运行已经可以根据滑块改变进度了，但是我们一直忘记处理缓存进度了。</p>
<p>在<code>ZZPlayerView</code> 中加一个变量 <code>var progressView:UIProgressView!</code>。</p>
<p>还是在<code>awakeFromNib</code> 中进行布局。<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">progressView = <span class="type">UIProgressView</span>()</div><div class="line">progressView.backgroundColor = <span class="type">UIColor</span>.lightGrayColor()</div><div class="line"><span class="keyword">self</span>.insertSubview(progressView, belowSubview: slider)</div><div class="line">progressView.snp_makeConstraints &#123; (make) <span class="keyword">in</span></div><div class="line">    make.<span class="keyword">left</span>.<span class="keyword">right</span>.equalTo(slider)</div><div class="line">    make.centerY.equalTo(slider)</div><div class="line">    make.height.equalTo(<span class="number">2</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">progressView.tintColor = <span class="type">UIColor</span>.redColor()</div><div class="line">progressView.progress = <span class="number">0</span></div></pre></td></tr></table></figure></p>
<p>为了比较清晰的看到进度，我们这里设置了红色。进度需要显示在slider下面和slider位置一样。</p>
<p>我VC中写一个方法来计算当前的缓冲进度<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">avalableDurationWithplayerItem</span><span class="params">()</span></span>-&gt;<span class="type">NSTimeInterval</span>&#123;</div><div class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> loadedTimeRanges = avplayer?.currentItem?.loadedTimeRanges,first = loadedTimeRanges.first <span class="keyword">else</span> &#123;<span class="built_in">fatalError</span>()&#125;</div><div class="line">    <span class="keyword">let</span> timeRange = first.<span class="type">CMTimeRangeValue</span></div><div class="line">    <span class="keyword">let</span> startSeconds = <span class="type">CMTimeGetSeconds</span>(timeRange.start)</div><div class="line">    <span class="keyword">let</span> durationSecound = <span class="type">CMTimeGetSeconds</span>(timeRange.duration)</div><div class="line">    <span class="keyword">let</span> result = startSeconds + durationSecound</div><div class="line">    <span class="keyword">return</span> result</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后在我们前面写的TODO也就是KVO监听缓冲进度的地方换成下面代码 :</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> keyPath == <span class="string">"loadedTimeRanges"</span>&#123;</div><div class="line">    <span class="comment">// 通过监听AVPlayerItem的"loadedTimeRanges"，可以实时知道当前视频的进度缓冲</span></div><div class="line">    <span class="keyword">let</span> loadedTime = avalableDurationWithplayerItem()</div><div class="line">    <span class="keyword">let</span> totalTime = <span class="type">CMTimeGetSeconds</span>(playerItem.duration)</div><div class="line">    <span class="keyword">let</span> percent = loadedTime/totalTime <span class="comment">// 计算出比例</span></div><div class="line">    <span class="comment">// 改变进度条</span></div><div class="line">    <span class="keyword">self</span>.playerView.progressView.progress = <span class="type">Float</span>(percent)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>至此，我们已经很好的处理了进度相关的工作 。 但是我们视频缺少播放和暂停键 。</p>
<h5 id="播放-暂停"><a href="#播放-暂停" class="headerlink" title="播放-暂停"></a>播放-暂停</h5><p>废话不多，继续干活。</p>
<p><code>ZZPlayerView</code> 中添加<code>var playBtn:UIButton!</code>变量。<br><code>awakeFromNib</code>中进行布局。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"> playBtn = <span class="type">UIButton</span>()</div><div class="line"><span class="keyword">self</span>.addSubview(playBtn)</div><div class="line">playBtn.snp_makeConstraints &#123; (make) <span class="keyword">in</span></div><div class="line">    make.centerY.equalTo(slider)</div><div class="line">    make.<span class="keyword">left</span>.equalTo(<span class="keyword">self</span>).offset(<span class="number">10</span>)</div><div class="line">    make.width.height.equalTo(<span class="number">30</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 设置按钮图片</span></div><div class="line">playBtn.setImage(<span class="type">UIImage</span>(named: <span class="string">"player_pause"</span>), forState: <span class="type">UIControlState</span>.<span class="type">Normal</span>)</div><div class="line"><span class="comment">// 点击事件</span></div><div class="line">playBtn.addTarget(<span class="keyword">self</span>, action: #selector(playAndPause( <span class="number">_</span>:)) , forControlEvents: <span class="type">UIControlEvents</span>.<span class="type">TouchUpInside</span>)</div></pre></td></tr></table></figure>
<p>这里又会设置一个状态表示，是否在播放，用来切换按钮的图片。播放和暂停是不同图片（同样可以下载我的项目使用，最后下载项目一期看）</p>
<p>添加变量<code>var playing = true</code> 表示是否正在播放 ， 因为播放和暂停是在VC中处理，这里依旧是代理。</p>
<p>协议中添加方法：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">zzplayer</span><span class="params">(playerView:ZZPlayerView,playAndPause playBtn:UIButton)</span></span></div></pre></td></tr></table></figure></p>
<p>处理点击事件</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">playAndPause</span><span class="params">(btn:UIButton)</span></span>&#123;</div><div class="line">    <span class="keyword">let</span> tmp = !playing</div><div class="line">    playing = tmp <span class="comment">// 改变状态</span></div><div class="line"></div><div class="line">    <span class="comment">// 根据状态设定图片</span></div><div class="line">    <span class="keyword">if</span> playing &#123;</div><div class="line">        playBtn.setImage(<span class="type">UIImage</span>(named: <span class="string">"player_pause"</span>), forState: <span class="type">UIControlState</span>.<span class="type">Normal</span>)</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        playBtn.setImage(<span class="type">UIImage</span>(named: <span class="string">"player_play"</span>), forState: <span class="type">UIControlState</span>.<span class="type">Normal</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 代理方法    </span></div><div class="line">    delegate?.zzplayer(<span class="keyword">self</span>, playAndPause: btn)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在VC中加上：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">zzplayer</span><span class="params">(playerView: ZZPlayerView, playAndPause playBtn: UIButton)</span></span> &#123;</div><div class="line">    <span class="keyword">if</span> !playerView.playing&#123;</div><div class="line">        <span class="keyword">self</span>.avplayer.pause()</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.avplayer.status == <span class="type">AVPlayerStatus</span>.<span class="type">ReadyToPlay</span>&#123;</div><div class="line">            <span class="keyword">self</span>.avplayer.play()</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>然后在<code>update</code>的最前面加上<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//暂停的时候</span></div><div class="line"><span class="keyword">if</span> !<span class="keyword">self</span>.playerView.playing&#123;</div><div class="line">    <span class="keyword">return</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>因为在暂停的时候不需要计算。</p>
<p>至此，我们基础版本的播放器实现完了，效果如图。这个播放器还缺少很多功能，比如：右划快进、左划快退 ，播放速度 1x 2x 0.5x等 左边上滑调整亮度 右边上滑调整音量 、 清晰度切换、 缓存下载等 。 而且还需要进一步封装。有时间会把这些补上 。 </p>
<p>github链接:<a href="https://github.com/smalldu/ZZPlayer" target="_blank" rel="external">https://github.com/smalldu/ZZPlayer</a><br>如果图片无法浏览可以移至简书:<a href="http://www.jianshu.com/p/d35980045c2b" target="_blank" rel="external">http://www.jianshu.com/p/d35980045c2b</a></p>
<p>参考链接:<br>    <a href="http://www.jianshu.com/p/de418c21d33c" target="_blank" rel="external">AVPlayer 本地、网络视频播放相关</a><br>    <a href="https://github.com/BrikerMan/BMPlayer" target="_blank" rel="external">BMPlayer</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/954071-f0f25ee81a868945.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;本篇效果图&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Swift" scheme="http://yoursite.com/categories/Swift/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
      <category term="Swift" scheme="http://yoursite.com/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>iOS 本地打包工具</title>
    <link href="http://yoursite.com/2016/08/17/iOS-%E6%9C%AC%E5%9C%B0%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7/"/>
    <id>http://yoursite.com/2016/08/17/iOS-本地打包工具/</id>
    <published>2016-08-17T05:06:31.000Z</published>
    <updated>2016-08-17T05:56:03.490Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/954071-c6f168aad484dd6f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="自动打包"></p>
<p>1、<strong>为什么要自动打包工具？</strong></p>
<p>每修改一个问题，测试都让你打包一个上传fir ， 你要clean -&gt; 编译打包 -&gt; 上传fir -&gt; 通知测试。而且打包速度好慢，太浪费时间了。如果有一个工具能自动的帮你做完上面所有的事情，岂不是快哉？<br><a id="more"></a><br>2、<strong>网上有那么多自动打包工具，我直接下载就行了为啥还要学习？</strong></p>
<p>没错网上有很多打包工具，包括github上也有一些直接从github下载并打包上传的，但是他们的不一定适合你，首先下载下来要配置各种参数，不会配，还有网上大多是针对普通项目，但是我们项目是cocoaPods管理的，编译的是 <code>xxx.xcworkspace</code> 不是 <code>xxx.xcodeproj</code> 。怎么办 ， <code>xxx.xcodeproj</code> 自动编译后就在你项目目录下会有 <code>xxx.app</code> 但是 <code>xxx.xcworkspace</code> 找不到怎么办？怎么指定目录 ， 这些网上的库大都没有的。 </p>
<p>3、<strong>需要哪些准备工作？</strong></p>
<p>首先你得有装<code>xcode</code> , <code>python3.5</code> （我装的版本,其他版本也行）,  待打包的项目。安装相关软件，随便搜索下就可以了。</p>
<p>废话结束，开始正文。本文介绍的是自动clean本地项目，编译 打包 上传fir 邮件通知相关人员。不涉及从git上下载。原理就是利用<code>python</code>执行控制台命令。对<br>iOS项目进行打包</p>
<h3 id="xcode控制台命令"><a href="#xcode控制台命令" class="headerlink" title="xcode控制台命令"></a>xcode控制台命令</h3><p><code>xcode</code> 控制台命令基本都是以 <code>xcodebuild</code> 开头的介绍几个简单的命令，大家可以在命令行试试。</p>
<ul>
<li><code>xcodebuild -version</code> 查看xcode的版本号和build的版本号</li>
<li><code>xcodebuild -showsdks</code> 显示当前系统的SDK、及其版本</li>
<li><code>xcodebuild -list</code> 先 <code>cd</code> 到工程目录下执行此命令 显示<code>target</code> <code>Schemes</code> 等</li>
</ul>
<h4 id="没有使用-cocoaPods-项目的编译"><a href="#没有使用-cocoaPods-项目的编译" class="headerlink" title="没有使用 cocoaPods 项目的编译"></a>没有使用 <code>cocoaPods</code> 项目的编译</h4><p>如果你的项目是普通的项目没有使用cocoaPods 那么 cd 到工程目录下直接执行 <code>xcodebuild build</code> ，就会自动编译了 参数都是默认 默认build release。<br>你也可以指定 <code>xcodebuild -configuration debug build</code> build的时候会在你工程目录下生成一个build文件夹，<code>build/Release-iphoneos/xx.app</code><br>就是一会打包成ipa需要的文件。 第一次build速度会比较慢，要把编译环境拉下来，不要删除build文件夹，以后build 速度就会变快。 </p>
<h4 id="使用了-cocoaPods-项目的编译"><a href="#使用了-cocoaPods-项目的编译" class="headerlink" title="使用了 cocoaPods 项目的编译"></a>使用了 <code>cocoaPods</code> 项目的编译</h4><p>如果不幸你也和我一样使用了<code>cocoaPods</code> , 其实也没啥不幸的 ，只是编译的时候就比较麻烦了 ，首先还是 cd 到项目目录 。但是你要指定编译文件和 <code>scheme</code><br>而且还要指定build后build文件夹的位置，如果位置找不到，后面怎么自动打包ipa？。</p>
<p>我这里的命令大概是这样的：<br><code>xcodebuild -workspace xxx.xcworkspace  -scheme 你的scheme -configuration debug -derivedDataPath 指定路径 ONLY_ACTIVE_ARCH=NO</code><br>这样就能正常编译并把build指定到我们想要去的目录</p>
<h4 id="打包ipa"><a href="#打包ipa" class="headerlink" title="打包ipa"></a>打包ipa</h4><p>打包ipa只要上面路径对了，打包指定从.app 文件的路径 ， 打包到你指定地方就行了。<br>命令：<br><code>xcrun -sdk iphoneos PackageApplication -v 这里填.app的路径 -o 指定存放ipa路径/文件名.ipa</code></p>
<h3 id="python实现篇"><a href="#python实现篇" class="headerlink" title="python实现篇"></a>python实现篇</h3><p>上面只是说了下编译的原理,下面看下怎么通过python自动处理这些任务 。</p>
<h4 id="clean、编译、打包"><a href="#clean、编译、打包" class="headerlink" title="clean、编译、打包"></a>clean、编译、打包</h4><p>首先创建一个xxx.py文件，需要你懂点<code>python</code> 语法，不懂就直接copy代码。不要改<code>tab</code> 。python的语法是严格按照<code>tab</code>区分的。后面我会放上我的代码，你们改改<br>变量就可以使用。</p>
<p>首先你需要引入一些外部依赖。设置编码为utf-8</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">import</span> hashlib</div><div class="line"><span class="keyword">from</span> email <span class="keyword">import</span> encoders</div><div class="line"><span class="keyword">from</span> email.header <span class="keyword">import</span> Header</div><div class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</div><div class="line"><span class="keyword">from</span> email.utils <span class="keyword">import</span> parseaddr, formataddr</div><div class="line"><span class="keyword">import</span> smtplib</div></pre></td></tr></table></figure>
<p>第一步 ， 声明一些变量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 项目根目录</span></div><div class="line">project_path = <span class="string">"/Users/xx/project"</span></div><div class="line"><span class="comment"># 编译成功后.app所在目录</span></div><div class="line">app_path = <span class="string">"/Users/xx/project/build/Build/Products/Release-iphoneos/xxx.app"</span></div><div class="line"><span class="comment"># 指定项目下编译目录</span></div><div class="line">build_path = <span class="string">"build"</span></div><div class="line"><span class="comment"># 打包后ipa存储目录</span></div><div class="line">targerIPA_parth = <span class="string">"/Users/xx/Desktop"</span></div></pre></td></tr></table></figure>
<p>第二步，clean，和创建一个文件夹，这里的示例是针对有使用cocoaPods的项目 ， 如果没有使用 不用创建文件夹 ，命令自行简化</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 清理项目 创建build目录</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_project_mkdir_build</span><span class="params">()</span>:</span></div><div class="line">    os.system(<span class="string">'cd %s;xcodebuild clean'</span> % project_path) <span class="comment"># clean 项目</span></div><div class="line">    os.system(<span class="string">'cd %s;mkdir build'</span> % project_path) <span class="comment"># 创建目录</span></div></pre></td></tr></table></figure>
<p><code>%s</code> 是py的占位符，字符串类型。后面是真正的填充。</p>
<p>第三步编译项目</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_project</span><span class="params">()</span>:</span></div><div class="line">    print(<span class="string">"build release start"</span>)</div><div class="line">    os.system (<span class="string">'cd %s;xcodebuild -list'</span>)</div><div class="line">    os.system (<span class="string">'cd %s;xcodebuild -workspace xxx.xcworkspace  -scheme xxx -configuration release -derivedDataPath %s ONLY_ACTIVE_ARCH=NO || exit'</span> % (project_path,build_path))</div></pre></td></tr></table></figure>
<p>不知道<code>scheme</code>是啥的<code>xcodebuild -list</code> 自己查</p>
<p>第四步 打包<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 打包ipa 并且保存在桌面</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_ipa</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">global</span> ipa_filename</div><div class="line">    ipa_filename = time.strftime(<span class="string">'yourproject_%Y-%m-%d-%H-%M-%S.ipa'</span>,time.localtime(time.time()))</div><div class="line">    os.system (<span class="string">'xcrun -sdk iphoneos PackageApplication -v %s -o %s/%s'</span> % (app_path,targerIPA_parth,ipa_filename))</div></pre></td></tr></table></figure></p>
<p>然后你现在再编写个方法，按顺序调用就可以编译打包了 ，执行完会看到桌面的ipa</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    <span class="comment"># 清理并创建build目录</span></div><div class="line">    clean_project_mkdir_build()</div><div class="line">    <span class="comment"># 编译coocaPods项目文件并 执行编译目录</span></div><div class="line">    build_project()</div><div class="line">    <span class="comment"># 打包ipa 并制定到桌面</span></div><div class="line">    build_ipa()</div></pre></td></tr></table></figure>
<p>执行就在最下面直接调用就行了 <code>main()</code></p>
<h4 id="上传fir"><a href="#上传fir" class="headerlink" title="上传fir"></a>上传fir</h4><p>我们是把代码上传到fir测试的，如果你们用的蒲公英或者其他，请自行搜索。<br>通过 <code>gem install fir-cli</code> 如果你没有ruby环境，自行搜索 </p>
<p>安装完成后，在命令行输入fir 回车 。会有fir的命令提示。我们上传fir需要fir的API_TOKEN , 去fir官网登录找好就能找到。<br>拿到那一串串字符，在变量区加上<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># firm的api token</span></div><div class="line">fir_api_token = <span class="string">"xxxxxxxxxxxxxxxxxxxxxxxxxx"</span></div></pre></td></tr></table></figure></p>
<p>然后命令传入ipa目录和token就可以上传了<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#上传</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_fir</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">if</span> os.path.exists(<span class="string">"%s/%s"</span> % (targerIPA_parth,ipa_filename)):</div><div class="line">        print(<span class="string">'watting...'</span>)</div><div class="line">        <span class="comment"># 直接使用fir 有问题 这里使用了绝对地址 在终端通过 which fir 获得</span></div><div class="line">        ret = os.system(<span class="string">"/usr/local/bin/fir p '%s/%s' -T '%s'"</span> % (targerIPA_parth,ipa_filename,fir_api_token))</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        print(<span class="string">"没有找到ipa文件"</span>)</div></pre></td></tr></table></figure></p>
<p>这里也有遇到一个=坑，就是在终端直接fir 带后面的就可以执行 ，但是在这里识别不了命令，必须制定全路径，怎么找命令的全路径呢？终端输入 <code>which fir</code></p>
<h4 id="发邮件"><a href="#发邮件" class="headerlink" title="发邮件"></a>发邮件</h4><p>具体发邮件功能看代码，这里有几个变量。我使用的是新浪邮箱发的，smtp服务器 ， 如果你是 pop3 请更换，还要在邮箱里开启相应的服务</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">from_addr = <span class="string">"xxxx@sina.com"</span></div><div class="line">password = <span class="string">"*****"</span></div><div class="line">smtp_server = <span class="string">"smtp.sina.com"</span></div><div class="line">to_addr = <span class="string">'aaa@qq.com,bbbb@qq.com'</span></div></pre></td></tr></table></figure>
<p>然后发邮件的方法</p>
<p>我们的fir路径是固定的<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 发邮件</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_mail</span><span class="params">()</span>:</span></div><div class="line">    msg = MIMEText(<span class="string">'xxx iOS测试项目已经打包完毕，请前往 http://fir.im/xxxxx 下载测试！'</span>, <span class="string">'plain'</span>, <span class="string">'utf-8'</span>)</div><div class="line">    msg[<span class="string">'From'</span>] = _format_addr(<span class="string">'自动打包系统 &lt;%s&gt;'</span> % from_addr)</div><div class="line">    msg[<span class="string">'To'</span>] = _format_addr(<span class="string">'xxx测试人员 &lt;%s&gt;'</span> % to_addr)</div><div class="line">    msg[<span class="string">'Subject'</span>] = Header(<span class="string">'xxx iOS客户端打包程序'</span>, <span class="string">'utf-8'</span>).encode()</div><div class="line">    server = smtplib.SMTP(smtp_server, <span class="number">25</span>)</div><div class="line">    server.set_debuglevel(<span class="number">1</span>)</div><div class="line">    server.login(from_addr, password)</div><div class="line">    server.sendmail(from_addr, [to_addr], msg.as_string())</div><div class="line">    server.quit()</div></pre></td></tr></table></figure></p>
<p>然后执行顺序是这样的<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    <span class="comment"># 清理并创建build目录</span></div><div class="line">    clean_project_mkdir_build()</div><div class="line">    <span class="comment"># 编译coocaPods项目文件并 执行编译目录</span></div><div class="line">    build_project()</div><div class="line">    <span class="comment"># 打包ipa 并制定到桌面</span></div><div class="line">    build_ipa()</div><div class="line">    <span class="comment"># 上传fir</span></div><div class="line">    upload_fir()</div><div class="line">    <span class="comment"># 发邮件</span></div><div class="line">    send_mail()</div><div class="line"></div><div class="line"><span class="comment"># 执行</span></div><div class="line">main()</div></pre></td></tr></table></figure></p>
<p>本文重点在自动打包命令上，python代码感兴趣的可以去<a href="http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000" target="_blank" rel="external">Python教程</a> 学习。<br>本文代码已经托管在github上：<a href="https://github.com/smalldu/autoipa" target="_blank" rel="external">https://github.com/smalldu/autoipa</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/954071-c6f168aad484dd6f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;自动打包&quot;&gt;&lt;/p&gt;
&lt;p&gt;1、&lt;strong&gt;为什么要自动打包工具？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;每修改一个问题，测试都让你打包一个上传fir ， 你要clean -&amp;gt; 编译打包 -&amp;gt; 上传fir -&amp;gt; 通知测试。而且打包速度好慢，太浪费时间了。如果有一个工具能自动的帮你做完上面所有的事情，岂不是快哉？&lt;br&gt;
    
    </summary>
    
      <category term="python" scheme="http://yoursite.com/categories/python/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
      <category term="python" scheme="http://yoursite.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>RxSwift(七) Mathematical and Aggregate Operators（数学和聚集操作）</title>
    <link href="http://yoursite.com/2016/08/16/RxSwift-%E4%B8%83-Mathematical-and-Aggregate-Operators%EF%BC%88%E6%95%B0%E5%AD%A6%E5%92%8C%E8%81%9A%E9%9B%86%E6%93%8D%E4%BD%9C%EF%BC%89/"/>
    <id>http://yoursite.com/2016/08/16/RxSwift-七-Mathematical-and-Aggregate-Operators（数学和聚集操作）/</id>
    <published>2016-08-16T14:15:40.000Z</published>
    <updated>2016-08-16T14:36:28.450Z</updated>
    
    <content type="html"><![CDATA[<hr>
<blockquote>
<p>本文大多数内容来自RxSwift项目中的<em>Rx.playground</em> , 个人学习记录 。仅供参考，有任何错误，请及时指出。</p>
</blockquote>
<h4 id="toArray"><a href="#toArray" class="headerlink" title="toArray"></a>toArray</h4><p>将一个<code>Observable</code> sequence 转成一个 <code>Array</code> , 只有一个数组元素的<code>Observable</code> 序列</p>
<a id="more"></a>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">        </div><div class="line"><span class="type">Observable</span>.range(start: <span class="number">1</span>, <span class="built_in">count</span>: <span class="number">5</span>)</div><div class="line">    .toArray()</div><div class="line">    .subscribe &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>结果 ： <code>Next([1, 2, 3, 4, 5]) Completed</code> </p>
<h4 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h4><p>从一个初始值 挨个执行运算 得到最后结果 返回一个单个结果的 <code>Observable</code> 序列</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"></div><div class="line"><span class="type">Observable</span>.of(<span class="number">10</span>, <span class="number">100</span>, <span class="number">1000</span>)</div><div class="line">    .<span class="built_in">reduce</span>(<span class="number">1</span>, accumulator: +)</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>结果 : <code>1111</code></p>
<h4 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h4><p>将多个 <code>Observable</code> 连接起来 只有当前一个执行结束了 才开始第二个 </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">        </div><div class="line"><span class="keyword">let</span> subject1 = <span class="type">BehaviorSubject</span>(value: <span class="string">"🍎"</span>)</div><div class="line"><span class="keyword">let</span> subject2 = <span class="type">BehaviorSubject</span>(value: <span class="string">"🐶"</span>)</div><div class="line"></div><div class="line"><span class="keyword">let</span> variable = <span class="type">Variable</span>(subject1)</div><div class="line"></div><div class="line">variable.asObservable()</div><div class="line">    .concat()</div><div class="line">    .subscribe &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line"></div><div class="line">subject1.onNext(<span class="string">"🍐"</span>)</div><div class="line">subject1.onNext(<span class="string">"🍊"</span>)</div><div class="line"></div><div class="line">variable.value = subject2</div><div class="line"></div><div class="line">subject2.onNext(<span class="string">"I would be ignored"</span>)</div><div class="line">subject2.onNext(<span class="string">"I would be ignored"</span>)</div><div class="line">subject2.onNext(<span class="string">"I would be ignored"</span>)</div><div class="line">subject2.onNext(<span class="string">"🐱"</span>)</div><div class="line"></div><div class="line">subject1.onNext(<span class="string">"🍊"</span>)</div><div class="line">subject1.onCompleted()</div><div class="line"></div><div class="line">subject2.onNext(<span class="string">"🐭"</span>)</div></pre></td></tr></table></figure>
<p>结果 ：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Next(🍎)</div><div class="line">Next(🍐)</div><div class="line">Next(🍊)</div><div class="line">Next(🍊)</div><div class="line">Next(🐱)</div><div class="line">Next(🐭)</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;本文大多数内容来自RxSwift项目中的&lt;em&gt;Rx.playground&lt;/em&gt; , 个人学习记录 。仅供参考，有任何错误，请及时指出。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;toArray&quot;&gt;&lt;a href=&quot;#toArray&quot; class=&quot;headerlink&quot; title=&quot;toArray&quot;&gt;&lt;/a&gt;toArray&lt;/h4&gt;&lt;p&gt;将一个&lt;code&gt;Observable&lt;/code&gt; sequence 转成一个 &lt;code&gt;Array&lt;/code&gt; , 只有一个数组元素的&lt;code&gt;Observable&lt;/code&gt; 序列&lt;/p&gt;
    
    </summary>
    
      <category term="RxSwift" scheme="http://yoursite.com/categories/RxSwift/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
      <category term="RxSwift" scheme="http://yoursite.com/tags/RxSwift/"/>
    
      <category term="Swift" scheme="http://yoursite.com/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>RxSwift(六) Filtering and Conditional Operators（过滤和条件操作）</title>
    <link href="http://yoursite.com/2016/08/16/RxSwift-%E5%85%AD-Filtering-and-Conditional-Operators%EF%BC%88%E8%BF%87%E6%BB%A4%E5%92%8C%E6%9D%A1%E4%BB%B6%E6%93%8D%E4%BD%9C%EF%BC%89/"/>
    <id>http://yoursite.com/2016/08/16/RxSwift-六-Filtering-and-Conditional-Operators（过滤和条件操作）/</id>
    <published>2016-08-16T14:15:14.000Z</published>
    <updated>2016-08-16T14:27:13.070Z</updated>
    
    <content type="html"><![CDATA[<hr>
<blockquote>
<p>本文大多数内容来自RxSwift项目中的<em>Rx.playground</em> , 个人学习记录 。仅供参考，有任何错误，请及时指出。</p>
</blockquote>
<h4 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h4><p>按照指定条件过滤出符合条件的结果<br><a id="more"></a><br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">      </div><div class="line"><span class="type">Observable</span>.of(</div><div class="line">    <span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>,</div><div class="line">    <span class="string">"🐸"</span>, <span class="string">"🐱"</span>, <span class="string">"🐰"</span>,</div><div class="line">    <span class="string">"🐹"</span>, <span class="string">"🐸"</span>, <span class="string">"🐱"</span>)</div><div class="line">    .<span class="built_in">filter</span> &#123;</div><div class="line">        $<span class="number">0</span> == <span class="string">"🐱"</span></div><div class="line">    &#125;</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure></p>
<p>结果 ：<code>🐱 🐱 🐱</code>  </p>
<h4 id="distinctUntilChanged"><a href="#distinctUntilChanged" class="headerlink" title="distinctUntilChanged"></a>distinctUntilChanged</h4><p>遇到连续重复的 只取一个 直到有不一样的</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">        </div><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐷"</span>, <span class="string">"🐱"</span>, <span class="string">"🐱"</span>, <span class="string">"🐱"</span>, <span class="string">"🐵"</span>, <span class="string">"🐱"</span>)</div><div class="line">    .distinctUntilChanged()</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">🐱</div><div class="line">🐷</div><div class="line">🐱</div><div class="line">🐵</div><div class="line">🐱</div></pre></td></tr></table></figure></p>
<h4 id="elementAt"><a href="#elementAt" class="headerlink" title="elementAt"></a>elementAt</h4><p>取出对应下标的元素</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">        </div><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>, <span class="string">"🐸"</span>, <span class="string">"🐷"</span>, <span class="string">"🐵"</span>)</div><div class="line">    .elementAt(<span class="number">3</span>)</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>结果: <code>🐸</code>     从 0 开始</p>
<h4 id="single"><a href="#single" class="headerlink" title="single"></a>single</h4><p>调用第一个元素（或者符合条件的第一个） ， 如果没有满足的元素将会抛出异常 。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">        </div><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>, <span class="string">"🐸"</span>, <span class="string">"🐷"</span>, <span class="string">"🐵"</span>)</div><div class="line">    .single()</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>result: <code>🐱</code> </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">        </div><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>, <span class="string">"🐸"</span>, <span class="string">"🐷"</span>, <span class="string">"🐵"</span>)</div><div class="line">    .single &#123; $<span class="number">0</span> == <span class="string">"🐸"</span> &#125;</div><div class="line">    .subscribe &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line"></div><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>, <span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>)</div><div class="line">    .single &#123; $<span class="number">0</span> == <span class="string">"🐰"</span> &#125;</div><div class="line">    .subscribe &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line"></div><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>, <span class="string">"🐸"</span>, <span class="string">"🐷"</span>, <span class="string">"🐵"</span>)</div><div class="line">    .single &#123; $<span class="number">0</span> == <span class="string">"🔵"</span> &#125;</div><div class="line">    .subscribe &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>结果： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Next(🐸)</div><div class="line">Completed</div><div class="line">Next(🐰)</div><div class="line">Error(Sequence contains more than one element.)</div><div class="line">Error(Sequence doesn&apos;t contain any elements.)</div></pre></td></tr></table></figure>
<h4 id="take"><a href="#take" class="headerlink" title="take"></a>take</h4><p>从头开始调用指定数量的元素<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">        </div><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>, <span class="string">"🐸"</span>, <span class="string">"🐷"</span>, <span class="string">"🐵"</span>)</div><div class="line">    .take(<span class="number">3</span>)</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure></p>
<p>结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">🐱</div><div class="line">🐰</div><div class="line">🐶</div></pre></td></tr></table></figure>
<h4 id="takeLast"><a href="#takeLast" class="headerlink" title="takeLast"></a>takeLast</h4><p>从结尾开始 </p>
<h4 id="takeWhile"><a href="#takeWhile" class="headerlink" title="takeWhile"></a>takeWhile</h4><p>从头开始调直到不满足条件<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">        </div><div class="line"><span class="type">Observable</span>.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</div><div class="line">    .takeWhile &#123; $<span class="number">0</span> &lt; <span class="number">4</span> &#125;</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure></p>
<p>结果 ：<code>1 2 3</code></p>
<h4 id="takeUntil"><a href="#takeUntil" class="headerlink" title="takeUntil"></a>takeUntil</h4><p><code>Observable</code> 按顺序调用 直到关联的 <code>Observable</code> 调用了后 他自己的就不调用了 </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">        </div><div class="line"><span class="keyword">let</span> sourceSequence = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line"><span class="keyword">let</span> referenceSequence = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line"></div><div class="line">sourceSequence</div><div class="line">    .takeUntil(referenceSequence)</div><div class="line">    .subscribe &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line"></div><div class="line">sourceSequence.onNext(<span class="string">"🐱"</span>)</div><div class="line">sourceSequence.onNext(<span class="string">"🐰"</span>)</div><div class="line">sourceSequence.onNext(<span class="string">"🐶"</span>)</div><div class="line"></div><div class="line">referenceSequence.onNext(<span class="string">"🔴"</span>)</div><div class="line"></div><div class="line">sourceSequence.onNext(<span class="string">"🐸"</span>)</div><div class="line">sourceSequence.onNext(<span class="string">"🐷"</span>)</div><div class="line">sourceSequence.onNext(<span class="string">"🐵"</span>)</div></pre></td></tr></table></figure>
<p>结果:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Next(🐱)</div><div class="line">Next(🐰)</div><div class="line">Next(🐶)</div><div class="line">Completed</div></pre></td></tr></table></figure></p>
<h4 id="skip"><a href="#skip" class="headerlink" title="skip"></a>skip</h4><p>从头开始 跳过 几个 跟take相反</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"></div><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>, <span class="string">"🐸"</span>, <span class="string">"🐷"</span>, <span class="string">"🐵"</span>)</div><div class="line">    .skip(<span class="number">2</span>)</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>结果 ：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">🐶</div><div class="line">🐸</div><div class="line">🐷</div><div class="line">🐵</div></pre></td></tr></table></figure></p>
<h4 id="skipWhile"><a href="#skipWhile" class="headerlink" title="skipWhile"></a>skipWhile</h4><p>从头开始直到条件为false </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">        </div><div class="line"><span class="type">Observable</span>.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">3</span>)</div><div class="line">    .skipWhile &#123; $<span class="number">0</span> &lt; <span class="number">4</span> &#125;</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>结果 ： <code>4 5 6 3</code></p>
<h4 id="skipWhileWithIndex"><a href="#skipWhileWithIndex" class="headerlink" title="skipWhileWithIndex"></a>skipWhileWithIndex</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">        </div><div class="line"><span class="type">Observable</span>.of(<span class="string">"🐱"</span>, <span class="string">"🐰"</span>, <span class="string">"🐶"</span>, <span class="string">"🐸"</span>, <span class="string">"🐷"</span>, <span class="string">"🐵"</span>)</div><div class="line">    .skipWhileWithIndex &#123; element, index <span class="keyword">in</span></div><div class="line">        index &lt; <span class="number">3</span></div><div class="line">    &#125;</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>结果 :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">🐸</div><div class="line">🐷</div><div class="line">🐵</div></pre></td></tr></table></figure></p>
<h4 id="skipUntil"><a href="#skipUntil" class="headerlink" title="skipUntil"></a>skipUntil</h4><p>跟take相反  直到关联的序列开始执行 它才开始<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">    </div><div class="line"><span class="keyword">let</span> sourceSequence = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line"><span class="keyword">let</span> referenceSequence = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line"></div><div class="line">sourceSequence</div><div class="line">    .skipUntil(referenceSequence)</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line"></div><div class="line">sourceSequence.onNext(<span class="string">"🐱"</span>)</div><div class="line">sourceSequence.onNext(<span class="string">"🐰"</span>)</div><div class="line">sourceSequence.onNext(<span class="string">"🐶"</span>)</div><div class="line"></div><div class="line">referenceSequence.onNext(<span class="string">"🔴"</span>)</div><div class="line"></div><div class="line">sourceSequence.onNext(<span class="string">"🐸"</span>)</div><div class="line">sourceSequence.onNext(<span class="string">"🐷"</span>)</div><div class="line">sourceSequence.onNext(<span class="string">"🐵"</span>)</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">🐸</div><div class="line">🐷</div><div class="line">🐵</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;本文大多数内容来自RxSwift项目中的&lt;em&gt;Rx.playground&lt;/em&gt; , 个人学习记录 。仅供参考，有任何错误，请及时指出。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;filter&quot;&gt;&lt;a href=&quot;#filter&quot; class=&quot;headerlink&quot; title=&quot;filter&quot;&gt;&lt;/a&gt;filter&lt;/h4&gt;&lt;p&gt;按照指定条件过滤出符合条件的结果&lt;br&gt;
    
    </summary>
    
      <category term="RxSwift" scheme="http://yoursite.com/categories/RxSwift/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
      <category term="RxSwift" scheme="http://yoursite.com/tags/RxSwift/"/>
    
      <category term="Swift" scheme="http://yoursite.com/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>RxSwift(五) Transforming Operators（转换操作）</title>
    <link href="http://yoursite.com/2016/08/16/RxSwift-%E4%BA%94-Transforming-Operators%EF%BC%88%E8%BD%AC%E6%8D%A2%E6%93%8D%E4%BD%9C%EF%BC%89/"/>
    <id>http://yoursite.com/2016/08/16/RxSwift-五-Transforming-Operators（转换操作）/</id>
    <published>2016-08-16T14:14:42.000Z</published>
    <updated>2016-08-16T14:23:20.410Z</updated>
    
    <content type="html"><![CDATA[<hr>
<blockquote>
<p>本文大多数内容来自RxSwift项目中的<em>Rx.playground</em> , 个人学习记录 。仅供参考，有任何错误，请及时指出。</p>
</blockquote>
<h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><p>通过一个闭包改变<code>Observable</code> 序列元素，返回一个新的<code>Observable</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="type">Observable</span>.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</div><div class="line">    .<span class="built_in">map</span> &#123; $<span class="number">0</span> * $<span class="number">0</span> &#125;</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>结果:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1</div><div class="line">4</div><div class="line">9</div></pre></td></tr></table></figure></p>
<h4 id="flatMap-和-flatMapLatest"><a href="#flatMap-和-flatMapLatest" class="headerlink" title="flatMap 和 flatMapLatest"></a>flatMap 和 flatMapLatest</h4><p><code>flatMap</code> 可以把一个序列转换成一组序列，然后再把这一组序列『拍扁』成一个序列 。<br><code>flatMapLatest</code> 只保留最新的序列</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">        </div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Player</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> score: <span class="type">Variable</span>&lt;<span class="type">Int</span>&gt;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> 👦 = <span class="type">Player</span>(score: <span class="type">Variable</span>(<span class="number">80</span>))</div><div class="line"><span class="keyword">let</span> 👧 = <span class="type">Player</span>(score: <span class="type">Variable</span>(<span class="number">90</span>))</div><div class="line"></div><div class="line"><span class="keyword">let</span> player = <span class="type">Variable</span>(👦)</div><div class="line"></div><div class="line">player.asObservable()</div><div class="line">    .flatMap &#123; $<span class="number">0</span>.score.asObservable() &#125; <span class="comment">// 可以换成flatMapLatest试试</span></div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line"></div><div class="line">👦.score.value = <span class="number">85</span></div><div class="line"></div><div class="line">player.value = 👧</div><div class="line"></div><div class="line">👦.score.value = <span class="number">95</span> <span class="comment">// flatMap 会打印 flatMapLatest不会</span></div><div class="line">👧.score.value = <span class="number">100</span></div></pre></td></tr></table></figure>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">80</div><div class="line">85</div><div class="line">90</div><div class="line">95</div><div class="line">100</div></pre></td></tr></table></figure></p>
<p><code>flatMapLatest</code> 相当于是 <code>map</code> 和 <code>switchLatest</code> 操作的结合 </p>
<h4 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h4><p>把每次的运算结果累积起来，作为下一次运算的输入值。<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">   </div><div class="line"><span class="type">Observable</span>.of(<span class="number">10</span>, <span class="number">100</span>, <span class="number">1000</span>)</div><div class="line">    .scan(<span class="number">1</span>) &#123; aggregateValue, newValue <span class="keyword">in</span></div><div class="line">        aggregateValue + newValue</div><div class="line">    &#125;</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure></p>
<p>结果：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">        </div><div class="line"><span class="type">Observable</span>.of(<span class="number">10</span>, <span class="number">100</span>, <span class="number">1000</span>)</div><div class="line">    .scan(<span class="number">1</span>) &#123; aggregateValue, newValue <span class="keyword">in</span></div><div class="line">        aggregateValue + newValue</div><div class="line">    &#125;</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure></p>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">11</div><div class="line">111</div><div class="line">1111</div></pre></td></tr></table></figure></p>
<p> <code>scan</code> 可以付一个初始值</p>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;本文大多数内容来自RxSwift项目中的&lt;em&gt;Rx.playground&lt;/em&gt; , 个人学习记录 。仅供参考，有任何错误，请及时指出。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;map&quot;&gt;&lt;a href=&quot;#map&quot; class=&quot;headerlink&quot; title=&quot;map&quot;&gt;&lt;/a&gt;map&lt;/h4&gt;&lt;p&gt;通过一个闭包改变&lt;code&gt;Observable&lt;/code&gt; 序列元素，返回一个新的&lt;code&gt;Observable&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; disposeBag = &lt;span class=&quot;type&quot;&gt;DisposeBag&lt;/span&gt;()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;Observable&lt;/span&gt;.of(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    .&lt;span class=&quot;built_in&quot;&gt;map&lt;/span&gt; &amp;#123; $&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; * $&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    .subscribeNext &amp;#123; &lt;span class=&quot;built_in&quot;&gt;print&lt;/span&gt;($&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    .addDisposableTo(disposeBag)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="RxSwift" scheme="http://yoursite.com/categories/RxSwift/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
      <category term="RxSwift" scheme="http://yoursite.com/tags/RxSwift/"/>
    
      <category term="Swift" scheme="http://yoursite.com/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>RxSwift(四) Combination Operators</title>
    <link href="http://yoursite.com/2016/08/16/RxSwift-%E5%9B%9B-Combination-Operators/"/>
    <id>http://yoursite.com/2016/08/16/RxSwift-四-Combination-Operators/</id>
    <published>2016-08-16T14:14:08.000Z</published>
    <updated>2016-08-16T14:23:14.320Z</updated>
    
    <content type="html"><![CDATA[<hr>
<blockquote>
<p>本文大多数内容来自RxSwift项目中的<em>Rx.playground</em> , 个人学习记录 。仅供参考，有任何错误，请及时指出。</p>
</blockquote>
<p>将多个<code>Observable</code> 组装成一个 <code>Observable</code></p>
<h4 id="startWith"><a href="#startWith" class="headerlink" title="startWith"></a>startWith</h4><p>会在队列开始之前插入一个事件元素</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="type">Observable</span>&lt;<span class="type">String</span>&gt;.of(<span class="string">"🐶"</span>,<span class="string">"🐱"</span>)</div><div class="line">    .startWith(<span class="string">"1"</span>)</div><div class="line">    .startWith(<span class="string">"2"</span>)</div><div class="line">    .startWith(<span class="string">"3"</span>,<span class="string">"A"</span>,<span class="string">"B"</span>)</div><div class="line">    .subscribeNext&#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>result : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">3</div><div class="line">A</div><div class="line">B</div><div class="line">2</div><div class="line">1</div><div class="line">🐶</div><div class="line">🐱</div></pre></td></tr></table></figure>
<h4 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h4><p>把两个队列按照顺序组合在一起</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">        </div><div class="line"><span class="keyword">let</span> subject1 = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line"><span class="keyword">let</span> subject2 = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line"></div><div class="line"><span class="type">Observable</span>.of(subject1, subject2)</div><div class="line">    .merge()</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line"></div><div class="line">subject1.onNext(<span class="string">"🅰️"</span>)</div><div class="line">subject1.onNext(<span class="string">"🅱️"</span>)</div><div class="line">subject2.onNext(<span class="string">"①"</span>)</div><div class="line">subject2.onNext(<span class="string">"②"</span>)</div></pre></td></tr></table></figure>
<p>result：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">🅰️</div><div class="line">🅱️</div><div class="line">①</div><div class="line">②</div></pre></td></tr></table></figure>
<h4 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h4><p>就是压缩两条队列用的，不过它会等到两个队列的元素一一对应地凑齐了之后再合并。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"></div><div class="line"><span class="keyword">let</span> stringSubject = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line"><span class="keyword">let</span> intSubject = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</div><div class="line"></div><div class="line"><span class="type">Observable</span>.<span class="built_in">zip</span>(stringSubject, intSubject) &#123; stringElement, intElement <span class="keyword">in</span></div><div class="line">    <span class="string">"<span class="subst">\(stringElement)</span> ===== <span class="subst">\(intElement)</span>"</span></div><div class="line">    &#125;</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line"></div><div class="line">stringSubject.onNext(<span class="string">"🅰️"</span>)</div><div class="line">stringSubject.onNext(<span class="string">"🅱️"</span>)</div><div class="line"></div><div class="line">intSubject.onNext(<span class="number">1</span>)</div><div class="line">intSubject.onNext(<span class="number">2</span>)</div></pre></td></tr></table></figure>
<p>result:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">🅰️ ===== 1</div><div class="line">🅱️ ===== 2</div></pre></td></tr></table></figure></p>
<h4 id="combineLatest"><a href="#combineLatest" class="headerlink" title="combineLatest"></a>combineLatest</h4><p>如果存在两条事件队列，需要同时监听，那么每当有新的事件发生的时候，combineLatest 会将每个队列的最新的一个元素进行合并。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">        </div><div class="line"><span class="keyword">let</span> stringSubject = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line"><span class="keyword">let</span> intSubject = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</div><div class="line"></div><div class="line"><span class="type">Observable</span>.combineLatest(stringSubject, intSubject) &#123; stringElement, intElement <span class="keyword">in</span></div><div class="line">    <span class="string">"<span class="subst">\(stringElement)</span> ==== <span class="subst">\(intElement)</span>"</span></div><div class="line">    &#125;</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line"></div><div class="line">stringSubject.onNext(<span class="string">"🅰️"</span>)</div><div class="line">stringSubject.onNext(<span class="string">"🅱️"</span>)</div><div class="line"></div><div class="line">intSubject.onNext(<span class="number">1</span>)</div><div class="line">intSubject.onNext(<span class="number">2</span>)</div><div class="line"></div><div class="line">stringSubject.onNext(<span class="string">"🆎"</span>)</div></pre></td></tr></table></figure>
<p>结果:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">🅱️ ==== 1</div><div class="line">🅱️ ==== 2</div><div class="line">🆎 ==== 2</div></pre></td></tr></table></figure></p>
<p>CombineLatest 用在数组上</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">        </div><div class="line"><span class="keyword">let</span> stringObservable = <span class="type">Observable</span>.just(<span class="string">"❤️"</span>)</div><div class="line"><span class="keyword">let</span> fruitObservable = [<span class="string">"🍎"</span>, <span class="string">"🍐"</span>, <span class="string">"🍊"</span>].toObservable()</div><div class="line"><span class="keyword">let</span> animalObservable = <span class="type">Observable</span>.of(<span class="string">"🐶"</span>, <span class="string">"🐱"</span>, <span class="string">"🐭"</span>, <span class="string">"🐹"</span>)</div><div class="line"></div><div class="line">[stringObservable, fruitObservable, animalObservable].combineLatest &#123;</div><div class="line">    <span class="string">"<span class="subst">\($<span class="number">0</span>[<span class="number">0</span>])</span> <span class="subst">\($<span class="number">0</span>[<span class="number">1</span>])</span> <span class="subst">\($<span class="number">0</span>[<span class="number">2</span>])</span>"</span></div><div class="line">    &#125;</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">❤️ 🍊 🐶</div><div class="line">❤️ 🍊 🐱</div><div class="line">❤️ 🍊 🐭</div><div class="line">❤️ 🍊 🐹</div></pre></td></tr></table></figure>
<p>combineLatest 在数组上使用需要所有原 <code>Observable</code> 元素类型相同</p>
<h4 id="switchLatest"><a href="#switchLatest" class="headerlink" title="switchLatest"></a>switchLatest</h4><p>把一个 <code>Observable</code> 赋值给另一个<code>Observable</code> , 会调用最新的 <code>Observable</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line">        </div><div class="line"><span class="keyword">let</span> subject1 = <span class="type">BehaviorSubject</span>(value: <span class="string">"⚽️"</span>)</div><div class="line"><span class="keyword">let</span> subject2 = <span class="type">BehaviorSubject</span>(value: <span class="string">"🍎"</span>)</div><div class="line"></div><div class="line"><span class="keyword">let</span> variable = <span class="type">Variable</span>(subject1)</div><div class="line"></div><div class="line">variable.asObservable()</div><div class="line">    .switchLatest()</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line"></div><div class="line">subject1.onNext(<span class="string">"🏈"</span>)</div><div class="line">subject1.onNext(<span class="string">"🏀"</span>)</div><div class="line"></div><div class="line">variable.value = subject2</div><div class="line"></div><div class="line">subject1.onNext(<span class="string">"⚾️"</span>)  <span class="comment">// 不会打印 已经变成subject2</span></div><div class="line">subject2.onNext(<span class="string">"🍐"</span>)</div></pre></td></tr></table></figure>
<p>结果 ：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">⚽️</div><div class="line">🏈</div><div class="line">🏀</div><div class="line">🍎</div><div class="line">🍐</div></pre></td></tr></table></figure></p>
<p>例子中 <code>subject1.onNext(&quot;⚾️&quot;)</code> 在 <code>variable.value = subject2</code> 之后是没有作用的 ， 只有最新的<code>Observable</code> 才能发送事件 </p>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;本文大多数内容来自RxSwift项目中的&lt;em&gt;Rx.playground&lt;/em&gt; , 个人学习记录 。仅供参考，有任何错误，请及时指出。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;将多个&lt;code&gt;Observable&lt;/code&gt; 组装成一个 &lt;code&gt;Observable&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;startWith&quot;&gt;&lt;a href=&quot;#startWith&quot; class=&quot;headerlink&quot; title=&quot;startWith&quot;&gt;&lt;/a&gt;startWith&lt;/h4&gt;&lt;p&gt;会在队列开始之前插入一个事件元素&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; disposeBag = &lt;span class=&quot;type&quot;&gt;DisposeBag&lt;/span&gt;()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;Observable&lt;/span&gt;&amp;lt;&lt;span class=&quot;type&quot;&gt;String&lt;/span&gt;&amp;gt;.of(&lt;span class=&quot;string&quot;&gt;&quot;🐶&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;🐱&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    .startWith(&lt;span class=&quot;string&quot;&gt;&quot;1&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    .startWith(&lt;span class=&quot;string&quot;&gt;&quot;2&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    .startWith(&lt;span class=&quot;string&quot;&gt;&quot;3&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;A&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;B&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    .subscribeNext&amp;#123; &lt;span class=&quot;built_in&quot;&gt;print&lt;/span&gt;($&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    .addDisposableTo(disposeBag)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="RxSwift" scheme="http://yoursite.com/categories/RxSwift/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
      <category term="RxSwift" scheme="http://yoursite.com/tags/RxSwift/"/>
    
      <category term="Swift" scheme="http://yoursite.com/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>RxSwift(三) Subjects</title>
    <link href="http://yoursite.com/2016/08/16/RxSwift-%E4%B8%89-Subjects/"/>
    <id>http://yoursite.com/2016/08/16/RxSwift-三-Subjects/</id>
    <published>2016-08-16T14:13:19.000Z</published>
    <updated>2016-08-16T14:26:18.530Z</updated>
    
    <content type="html"><![CDATA[<hr>
<blockquote>
<p>本文大多数内容来自RxSwift项目中的<em>Rx.playground</em> , 个人学习记录 。仅供参考，有任何错误，请及时指出。</p>
</blockquote>
<hr>
<blockquote>
<p>Observable像是一个水管，会源源不断的有水冒出来。Subject就像一个水龙头，它可以套在水管上，接受Observable上面的事件。但是作为水龙头，它下面还可以被别的observer给subscribe了</p>
</blockquote>
<h4 id="PublishSubject"><a href="#PublishSubject" class="headerlink" title="PublishSubject"></a>PublishSubject</h4><p>发送observer订阅之后的事件，也就是说如果sequence上有.Next 的到来，但是这个时候某个observer还没有subscribe它，这个observer就收不到这条信息，它只会收到它订阅之后发生的事件。<br><a id="more"></a><br>官方demo<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ObservableType</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     通过id添加订阅者</div><div class="line">     - parameter id: id</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addObserver</span><span class="params">(id: String)</span></span> -&gt; <span class="type">Disposable</span> &#123;</div><div class="line">        <span class="keyword">return</span> subscribe &#123; <span class="built_in">print</span>(<span class="string">"Subscription:"</span>, id, <span class="string">"Event:"</span>, $<span class="number">0</span>) &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="keyword">let</span> subject = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line">subject.subscribe &#123; (event) <span class="keyword">in</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"Subscription"</span> , <span class="string">"默认"</span> , <span class="string">"Event:"</span>, event )</div><div class="line">    &#125;.addDisposableTo(disposeBag)</div><div class="line"></div><div class="line">subject.addObserver(<span class="string">"1"</span>).addDisposableTo(disposeBag)</div><div class="line">subject.onNext(<span class="string">"🐶"</span>)</div><div class="line">subject.onNext(<span class="string">"🐱"</span>)</div><div class="line"></div><div class="line">subject.addObserver(<span class="string">"2"</span>).addDisposableTo(disposeBag)</div><div class="line">subject.onNext(<span class="string">"🅰️"</span>)</div><div class="line">subject.on(.<span class="type">Next</span>(<span class="string">"🅱️"</span>))</div></pre></td></tr></table></figure></p>
<p>写了个extension 快捷添加subscribe 这里我也写了个不用addObserver的方式。<br>结果:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Subscription 默认 Event: Next(🐶)</div><div class="line">Subscription: 1 Event: Next(🐶)</div><div class="line">Subscription 默认 Event: Next(🐱)</div><div class="line">Subscription: 1 Event: Next(🐱)</div><div class="line">Subscription 默认 Event: Next(🅰️)</div><div class="line">Subscription: 1 Event: Next(🅰️)</div><div class="line">Subscription: 2 Event: Next(🅰️)</div><div class="line">Subscription 默认 Event: Next(🅱️)</div><div class="line">Subscription: 1 Event: Next(🅱️)</div><div class="line">Subscription: 2 Event: Next(🅱️)</div></pre></td></tr></table></figure></p>
<p><code>默认</code> 打印了四次 <code>1</code> 打印了四次 <code>2</code> 打印最后两次 ， 因为两个事件是在它订阅后输出的。</p>
<h4 id="ReplaySubject"><a href="#ReplaySubject" class="headerlink" title="ReplaySubject"></a>ReplaySubject</h4><p>会给所有订阅者发送事件 ， 还可以指定 <code>bufferSize</code> 数字 表示后面绑定的可以接收前面事件的数量</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="keyword">let</span> subject = <span class="type">ReplaySubject</span>&lt;<span class="type">String</span>&gt;.create(bufferSize: <span class="number">1</span>)</div><div class="line"></div><div class="line">subject.addObserver(<span class="string">"1"</span>).addDisposableTo(disposeBag)</div><div class="line">subject.onNext(<span class="string">"🐶"</span>)</div><div class="line">subject.onNext(<span class="string">"🐱"</span>)</div><div class="line"></div><div class="line">subject.addObserver(<span class="string">"2"</span>).addDisposableTo(disposeBag)</div><div class="line">subject.onNext(<span class="string">"🅰️"</span>)</div><div class="line">subject.onNext(<span class="string">"🅱️"</span>)</div></pre></td></tr></table></figure>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Subscription: 1 Event: Next(🐶)</div><div class="line">Subscription: 1 Event: Next(🐱)</div><div class="line">Subscription: 2 Event: Next(🐱)</div><div class="line">Subscription: 1 Event: Next(🅰️)</div><div class="line">Subscription: 2 Event: Next(🅰️)</div><div class="line">Subscription: 1 Event: Next(🅱️)</div><div class="line">Subscription: 2 Event: Next(🅱️)</div></pre></td></tr></table></figure></p>
<p><code>2</code> 只接收了🐱 并没有接收🐶 因为我们指定了bufferSize是 1</p>
<h4 id="BehaviorSubject"><a href="#BehaviorSubject" class="headerlink" title="BehaviorSubject"></a>BehaviorSubject</h4><p>当有observer在订阅一个BehaviorSubject的时候，它首先将会收到Observable上最近发送一个信号（或者是默认值），<br>接着才会收到Observable上会发送的序列。</p>
<p>例子 :<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="keyword">let</span> subject = <span class="type">BehaviorSubject</span>(value: <span class="string">"🔴"</span>)</div><div class="line"></div><div class="line">subject.addObserver(<span class="string">"1"</span>).addDisposableTo(disposeBag)</div><div class="line">subject.onNext(<span class="string">"🐶"</span>)</div><div class="line">subject.onNext(<span class="string">"🐱"</span>)</div><div class="line"></div><div class="line">subject.addObserver(<span class="string">"2"</span>).addDisposableTo(disposeBag)</div><div class="line">subject.onNext(<span class="string">"🅰️"</span>)</div><div class="line">subject.onNext(<span class="string">"🅱️"</span>)</div><div class="line"></div><div class="line">subject.addObserver(<span class="string">"3"</span>).addDisposableTo(disposeBag)</div><div class="line">subject.onNext(<span class="string">"🍐"</span>)</div><div class="line">subject.onNext(<span class="string">"🍊"</span>)</div></pre></td></tr></table></figure></p>
<p>结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">Subscription: 1 Event: Next(🔴)</div><div class="line">Subscription: 1 Event: Next(🐶)</div><div class="line">Subscription: 1 Event: Next(🐱)</div><div class="line">Subscription: 2 Event: Next(🐱)</div><div class="line">Subscription: 1 Event: Next(🅰️)</div><div class="line">Subscription: 2 Event: Next(🅰️)</div><div class="line">Subscription: 1 Event: Next(🅱️)</div><div class="line">Subscription: 2 Event: Next(🅱️)</div><div class="line">Subscription: 3 Event: Next(🅱️)</div><div class="line">Subscription: 1 Event: Next(🍐)</div><div class="line">Subscription: 2 Event: Next(🍐)</div><div class="line">Subscription: 3 Event: Next(🍐)</div><div class="line">Subscription: 1 Event: Next(🍊)</div><div class="line">Subscription: 2 Event: Next(🍊)</div><div class="line">Subscription: 3 Event: Next(🍊)</div></pre></td></tr></table></figure>
<h4 id="Variable"><a href="#Variable" class="headerlink" title="Variable"></a>Variable</h4><p>Variable是BehaviorSubject的封装，它和BehaviorSubject不同之处在于，不能向Variable发送.Complete和.Error，它会在生命周期结束被释放的时候自动发送.Complete。</p>
<p>示例：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="keyword">let</span> variable = <span class="type">Variable</span>(<span class="string">"🔴"</span>)</div><div class="line"></div><div class="line">variable.asObservable().addObserver(<span class="string">"1"</span>).addDisposableTo(disposeBag)</div><div class="line">variable.value = <span class="string">"🐶"</span></div><div class="line">variable.value = <span class="string">"🐱"</span></div><div class="line"></div><div class="line">variable.asObservable().addObserver(<span class="string">"2"</span>).addDisposableTo(disposeBag)</div><div class="line">variable.value = <span class="string">"🅰️"</span></div><div class="line">variable.value = <span class="string">"🅱️"</span></div></pre></td></tr></table></figure></p>
<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Subscription: 1 Event: Next(🔴)</div><div class="line">Subscription: 1 Event: Next(🐶)</div><div class="line">Subscription: 1 Event: Next(🐱)</div><div class="line">Subscription: 2 Event: Next(🐱)</div><div class="line">Subscription: 1 Event: Next(🅰️)</div><div class="line">Subscription: 2 Event: Next(🅰️)</div><div class="line">Subscription: 1 Event: Next(🅱️)</div><div class="line">Subscription: 2 Event: Next(🅱️)</div><div class="line">Subscription: 1 Event: Completed</div><div class="line">Subscription: 2 Event: Completed</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;本文大多数内容来自RxSwift项目中的&lt;em&gt;Rx.playground&lt;/em&gt; , 个人学习记录 。仅供参考，有任何错误，请及时指出。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;Observable像是一个水管，会源源不断的有水冒出来。Subject就像一个水龙头，它可以套在水管上，接受Observable上面的事件。但是作为水龙头，它下面还可以被别的observer给subscribe了&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;PublishSubject&quot;&gt;&lt;a href=&quot;#PublishSubject&quot; class=&quot;headerlink&quot; title=&quot;PublishSubject&quot;&gt;&lt;/a&gt;PublishSubject&lt;/h4&gt;&lt;p&gt;发送observer订阅之后的事件，也就是说如果sequence上有.Next 的到来，但是这个时候某个observer还没有subscribe它，这个observer就收不到这条信息，它只会收到它订阅之后发生的事件。&lt;br&gt;
    
    </summary>
    
      <category term="RxSwift" scheme="http://yoursite.com/categories/RxSwift/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
      <category term="RxSwift" scheme="http://yoursite.com/tags/RxSwift/"/>
    
      <category term="Swift" scheme="http://yoursite.com/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>RxSwift(二) 创建并订阅Observables</title>
    <link href="http://yoursite.com/2016/08/16/RxSwift-%E4%BA%8C-%E5%88%9B%E5%BB%BA%E5%B9%B6%E8%AE%A2%E9%98%85Observables/"/>
    <id>http://yoursite.com/2016/08/16/RxSwift-二-创建并订阅Observables/</id>
    <published>2016-08-16T08:56:48.000Z</published>
    <updated>2016-08-16T13:25:56.690Z</updated>
    
    <content type="html"><![CDATA[<hr>
<blockquote>
<p>本文大多数内容来自RxSwift项目中的<em>Rx.playground</em> , 个人学习记录 。仅供参考，有任何错误，请及时指出。</p>
</blockquote>
<p>有许多创建 <code>Observable</code> sequence （信号源序列）的方式 , 本文学习手动创建，实际应用中会时候RxCocoa帮我们创建好的，例如一个<code>UILabel</code> 会有一个<br><code>rx_text</code> 属性 返回一个 <code>Observable</code> 对象 ，这个实例的时候再看。</p>
<blockquote>
<p><code>Observable</code>相当于一个被观察的对象，是一个事件序列，订阅者可以订阅他检测事件(Next \ Complete \ Error)<br><a id="more"></a></p>
<h4 id="never"><a href="#never" class="headerlink" title="never"></a>never</h4></blockquote>
<p>创建一个永远不会终止，也不会发出任何事件的sequence </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="keyword">let</span> neverSequence = <span class="type">Observable</span>&lt;<span class="type">String</span>&gt;.never()</div><div class="line">&lt;!-- more --&gt;</div><div class="line"><span class="keyword">let</span> neverSequenceSubscription = neverSequence.subscribe &#123; <span class="number">_</span> <span class="keyword">in</span></div><div class="line">    <span class="built_in">print</span>(<span class="string">"永远不会执行"</span>)</div><div class="line">&#125;</div><div class="line">neverSequenceSubscription.addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<h4 id="empty"><a href="#empty" class="headerlink" title="empty"></a>empty</h4><p>创建一个只能执行Complete事件的空<code>Observable</code> sequence 。<br><!-- more --><br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;.empty()</div><div class="line">    .subscribe &#123; (event) <span class="keyword">in</span></div><div class="line">        <span class="built_in">print</span>(event)</div><div class="line">    &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure></p>
<p>执行上面代码会打印出Completed</p>
<h4 id="just"><a href="#just" class="headerlink" title="just"></a>just</h4><p>创建一个只有一个元素的<code>Observable</code> sequence </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="type">Observable</span>&lt;<span class="type">String</span>&gt;.just(<span class="string">"我是唯一的元素"</span>)</div><div class="line">    .subscribe &#123; (event) <span class="keyword">in</span></div><div class="line">        <span class="built_in">print</span>(event)</div><div class="line">    &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>打印结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Next(我是唯一的元素)</div><div class="line">Completed</div></pre></td></tr></table></figure></p>
<h4 id="of"><a href="#of" class="headerlink" title="of"></a>of</h4><p>创建一个有固定元素个数的<code>Observable</code> seqence</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="type">Observable</span>&lt;<span class="type">String</span>&gt;.of(<span class="string">"小猫"</span>,<span class="string">"🐶"</span>,<span class="string">"🌲"</span>,<span class="string">"🐍"</span>,<span class="string">"🐱"</span>)</div><div class="line">    .subscribeNext&#123; element <span class="keyword">in</span></div><div class="line">        <span class="built_in">print</span>(element)</div><div class="line">    &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>打印结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">小猫</div><div class="line">🐶</div><div class="line">🌲</div><div class="line">🐍</div><div class="line">🐱</div></pre></td></tr></table></figure></p>
<blockquote>
<p>这个示例介绍了<code>subscribeNext(_:)</code>用法，不像<code>subscribe(_:)</code> 返回一个事件类型的参数（Next, Error, and Completed）。<br><code>subscribeNext(_:)</code> 会忽略 Error 和 Complete 只拿Next事件的元素 。上面的element就是一个String ， 当然也有<code>subscribeError(_:)</code>和<br><code>subscribeCompleted(_:)</code> 方法。还有一个<code>subscribe(onNext:onError:onCompleted:onDisposed:)</code>方法允许你取到更多的事件类型达到你的目的。</p>
</blockquote>
<p>例如:<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="type">Observable</span>&lt;<span class="type">String</span>&gt;.of(<span class="string">"小猫"</span>,<span class="string">"🐶"</span>,<span class="string">"🌲"</span>,<span class="string">"🐍"</span>,<span class="string">"🐱"</span>).subscribe(</div><div class="line">                onNext: &#123; <span class="built_in">print</span>(<span class="string">"Element : <span class="subst">\($<span class="number">0</span>)</span>"</span>) &#125;,</div><div class="line">                onError: &#123; <span class="built_in">print</span>(<span class="string">"Error : <span class="subst">\($<span class="number">0</span>)</span>"</span>) &#125;,</div><div class="line">                onCompleted: &#123; <span class="built_in">print</span>(<span class="string">"Completed"</span>) &#125;,</div><div class="line">                onDisposed: &#123; <span class="built_in">print</span>(<span class="string">"Disposed"</span>) &#125;</div><div class="line">            )</div></pre></td></tr></table></figure></p>
<h4 id="toObservable"><a href="#toObservable" class="headerlink" title="toObservable"></a>toObservable</h4><p>使用<code>SequenceType</code>类型创建一个 <code>Observable</code> sequence , 例如数组、字典、Set</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[&quot;🐶&quot;, &quot;🐱&quot;, &quot;🐭&quot;, &quot;🐹&quot;].toObservable()</div><div class="line">            .subscribeNext &#123; print($0) &#125;</div><div class="line">            .addDisposableTo(DisposeBag())</div></pre></td></tr></table></figure>
<p>执行结果:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">🐶</div><div class="line">🐱</div><div class="line">🐭</div><div class="line">🐹</div></pre></td></tr></table></figure></p>
<p>这里是将数组的元素一个一个输出的。</p>
<h4 id="create"><a href="#create" class="headerlink" title="create"></a>create</h4><p>创建一个自定义的<code>Observable</code>sequence</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="keyword">let</span> myJust = &#123; (element:<span class="type">String</span>) -&gt; <span class="type">Observable</span>&lt;<span class="type">String</span>&gt; <span class="keyword">in</span></div><div class="line">    <span class="keyword">return</span> <span class="type">Observable</span>.create(&#123; observer -&gt; <span class="type">Disposable</span> <span class="keyword">in</span></div><div class="line">        observer.on(.<span class="type">Next</span>(element))</div><div class="line">        observer.on(.<span class="type">Completed</span>)</div><div class="line">        <span class="keyword">return</span> <span class="type">NopDisposable</span>.instance</div><div class="line">    &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">myJust(<span class="string">"🍎"</span>).subscribe&#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>这里穿件了一个myJust的闭包，传入 <code>String</code> 返回 <code>Observable</code> , 在创建方法里 我们调用了 Next 和 Complete方法。<br>然后我们对我们的对象添加了观察者。</p>
<h4 id="range"><a href="#range" class="headerlink" title="range"></a>range</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="type">Observable</span>.range(start: <span class="number">1</span>, <span class="built_in">count</span>: <span class="number">5</span>)</div><div class="line">    .subscribe &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>打印结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Next(1)</div><div class="line">Next(2)</div><div class="line">Next(3)</div><div class="line">Next(4)</div><div class="line">Next(5)</div><div class="line">Completed</div></pre></td></tr></table></figure></p>
<h4 id="repeatElement"><a href="#repeatElement" class="headerlink" title="repeatElement"></a>repeatElement</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="type">Observable</span>.repeatElement(<span class="string">"🔴"</span>)</div><div class="line">    .take(<span class="number">3</span>)</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">🔴</div><div class="line">🔴</div><div class="line">🔴</div></pre></td></tr></table></figure></p>
<p>这块使用take指定次数。</p>
<h4 id="generate"><a href="#generate" class="headerlink" title="generate"></a>generate</h4><p>利用迭代器创建一个<code>Observable</code> sequence 只有条件是true才执行</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()    </div><div class="line"><span class="type">Observable</span>.generate(</div><div class="line">    initialState: <span class="number">0</span>,</div><div class="line">    condition: &#123; $<span class="number">0</span> &lt; <span class="number">3</span> &#125;,</div><div class="line">    iterate: &#123; $<span class="number">0</span> + <span class="number">1</span> &#125;</div><div class="line">    )</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>输出 0,1,2</p>
<h4 id="deferred"><a href="#deferred" class="headerlink" title="deferred"></a>deferred</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="keyword">var</span> <span class="built_in">count</span> = <span class="number">1</span></div><div class="line"><span class="keyword">let</span> deferredSequence = <span class="type">Observable</span>&lt;<span class="type">String</span>&gt;.deferred &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"Creating <span class="subst">\(<span class="built_in">count</span>)</span>"</span>)</div><div class="line">    <span class="built_in">count</span> += <span class="number">1</span></div><div class="line">    <span class="keyword">return</span> <span class="type">Observable</span>.create &#123; observer <span class="keyword">in</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"正在调用..."</span>)</div><div class="line">        observer.onNext(<span class="string">"🐶"</span>)</div><div class="line">        observer.onNext(<span class="string">"🐱"</span>)</div><div class="line">        observer.onNext(<span class="string">"🐵"</span>)</div><div class="line">        <span class="keyword">return</span> <span class="type">NopDisposable</span>.instance</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">deferredSequence</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div><div class="line"></div><div class="line">deferredSequence</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Creating 1</div><div class="line">正在调用...</div><div class="line">🐶</div><div class="line">🐱</div><div class="line">🐵</div><div class="line">Creating 2</div><div class="line">正在调用...</div><div class="line">🐶</div><div class="line">🐱</div><div class="line">🐵</div></pre></td></tr></table></figure>
<h4 id="error"><a href="#error" class="headerlink" title="error"></a>error</h4><p>创建一个直接返回错误的<code>Observable</code>sequence</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="type">Observable</span>&lt;<span class="type">Int</span>&gt;.error(<span class="type">Error</span>.<span class="type">Test</span>)</div><div class="line">    .subscribe &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>输出<code>Error(Test)</code><br>这里自定义了一个继承自<code>ErrorType</code>的<code>Error</code>类型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public enum Error : ErrorType &#123;</div><div class="line">    case Test</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="doOn"><a href="#doOn" class="headerlink" title="doOn"></a>doOn</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</div><div class="line"><span class="type">Observable</span>.of(<span class="string">"🍎"</span>, <span class="string">"🍐"</span>, <span class="string">"🍊"</span>, <span class="string">"🍋"</span>)</div><div class="line">    .doOn &#123; <span class="built_in">print</span>(<span class="string">"Intercepted:"</span>, $<span class="number">0</span>) &#125;</div><div class="line">    .subscribeNext &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</div><div class="line">    .addDisposableTo(disposeBag)</div></pre></td></tr></table></figure>
<p>这里 <code>doOn</code> 和 <code>subscribe</code> 传入参数和返回值一样只是 <code>doOn</code> 会将异常throws出去</p>
<blockquote>
<p>系统也提供了<code>doOnNext(_:)</code>, <code>doOnError(_:)</code>, <code>doOnCompleted(_:)</code>这些方便的方法，当然还有<code>doOn(onNext:onError:onCompleted:)</code></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;本文大多数内容来自RxSwift项目中的&lt;em&gt;Rx.playground&lt;/em&gt; , 个人学习记录 。仅供参考，有任何错误，请及时指出。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;有许多创建 &lt;code&gt;Observable&lt;/code&gt; sequence （信号源序列）的方式 , 本文学习手动创建，实际应用中会时候RxCocoa帮我们创建好的，例如一个&lt;code&gt;UILabel&lt;/code&gt; 会有一个&lt;br&gt;&lt;code&gt;rx_text&lt;/code&gt; 属性 返回一个 &lt;code&gt;Observable&lt;/code&gt; 对象 ，这个实例的时候再看。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;Observable&lt;/code&gt;相当于一个被观察的对象，是一个事件序列，订阅者可以订阅他检测事件(Next \ Complete \ Error)&lt;br&gt;
    
    </summary>
    
      <category term="RxSwift" scheme="http://yoursite.com/categories/RxSwift/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
      <category term="RxSwift" scheme="http://yoursite.com/tags/RxSwift/"/>
    
      <category term="Swift" scheme="http://yoursite.com/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>RxSwift 简介</title>
    <link href="http://yoursite.com/2016/08/16/RxSwift(%E4%B8%80)-%E7%AE%80%E4%BB%8B/"/>
    <id>http://yoursite.com/2016/08/16/RxSwift(一)-简介/</id>
    <published>2016-08-16T08:42:31.000Z</published>
    <updated>2016-08-16T13:25:47.690Z</updated>
    
    <content type="html"><![CDATA[<hr>
<blockquote>
<p>本文大多数内容来自RxSwift项目中的<em>Rx.playground</em> , 个人学习记录 。仅供参考，有任何错误，请及时指出。</p>
</blockquote>
<h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p><strong>每个<code>Observable</code>实例都是一个sequence.</strong></p>
<p><code>Observable</code> sequence 的关键点在 <code>SequenceType</code> ， 而且它可以异步获取元素 。 这个是<em>RxSwift</em>的根本，其他的都是建立在这个概念之上的。<br><a id="more"></a></p>
<ul>
<li>一个<code>Observable(ObservableType)</code> 等价于 <code>SequenceType</code></li>
<li><code>ObservableType.subscribe(_:)</code> 方法等价于 <code>SequenceType.generate()</code>。</li>
<li><code>ObservableType.subscribe(_:)</code> 需要一个观察者(<code>ObserverType</code>) 参数，这样将自动接收sequence事件，<br>通过监听自动元素而不用手动调用<code>next()</code>。</li>
</ul>
<p>如果一个 <code>Observable</code> (这里指的是可观察的对象 信号源) 手动调用Next事件 (<code>Event.Next(Element)</code>) , 它可以链式的调用更多的事件 ，如果<code>Observable</code><br>调用了Error事件(<code>Event.Error(ErrorType)</code>) 或者 Completed事件(<code>Event.Completed</code>) , <code>Observable</code> sequence 将不能继续链式调用。</p>
<p>Sequence 语法简要解释：</p>
<p><big><code>Next* (Error | Completed)?</code></big> <br></p>
<p><big><code>--1--2--3--4--5--6--|----&gt;</code></big>  // “|” = 正常终止 <br></p>
<p><big><code>--a--b--c--d--e--f--X----&gt;</code></big>  // “X” = 出错终止 <br></p>
<p><big><code>--tap--tap----------tap--&gt;</code></big>  // “|” = 持续性事件,btn的一系列点击</p>
<h4 id="Observables-and-observers-观察对象和观察者"><a href="#Observables-and-observers-观察对象和观察者" class="headerlink" title="Observables and observers (观察对象和观察者)"></a>Observables and observers (观察对象和观察者)</h4><p><code>Observables</code>如果没有观察者（订阅者），它的事件闭包将不会执行。如下例子：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="number">_</span> = <span class="type">Observable</span>&lt;<span class="type">String</span>&gt;.create &#123; observerOfString -&gt; <span class="type">Disposable</span> <span class="keyword">in</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"This will never be printed"</span>)</div><div class="line">        observerOfString.on(.<span class="type">Next</span>(<span class="string">"😬"</span>))</div><div class="line">        observerOfString.on(.<span class="type">Completed</span>)</div><div class="line">        <span class="keyword">return</span> <span class="type">NopDisposable</span>.instance</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>执行这段代码 ，里面的内容并不会执行。前面加<code>_ =</code>是因为RxSwift 会警告返回值没有使用。</p>
<p>看下面的例子<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="number">_</span> = <span class="type">Observable</span>&lt;<span class="type">String</span>&gt;.create &#123; observerOfString -&gt; <span class="type">Disposable</span> <span class="keyword">in</span></div><div class="line">            <span class="built_in">print</span>(<span class="string">"这个将会执行"</span>)</div><div class="line">            observerOfString.on(.<span class="type">Next</span>(<span class="string">"😬"</span>))</div><div class="line">            observerOfString.on(.<span class="type">Completed</span>)</div><div class="line">            <span class="keyword">return</span> <span class="type">NopDisposable</span>.instance</div><div class="line">            &#125;.subscribe &#123; (event) <span class="keyword">in</span> <span class="comment">// 观察者</span></div><div class="line">                <span class="built_in">print</span>(event)</div><div class="line">        &#125;</div></pre></td></tr></table></figure></p>
<p>添加了这个<code>subscribe</code>观察者，这段代码执行会打印<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">这个将会执行</div><div class="line">Next(😬)</div><div class="line">Completed</div></pre></td></tr></table></figure></p>
<blockquote>
<p><code>subscribe(_:)</code>返回一个<code>Disposable</code>对象代表一个一次性资源例如订阅者。 上面的例子我们忽略了返回值，正常情况下是需要处理的，<br>一般情况下会把它添加到一个<code>DisposeBag</code>对象中，后面的章节会更多的介绍。</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;本文大多数内容来自RxSwift项目中的&lt;em&gt;Rx.playground&lt;/em&gt; , 个人学习记录 。仅供参考，有任何错误，请及时指出。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;概念&quot;&gt;&lt;a href=&quot;#概念&quot; class=&quot;headerlink&quot; title=&quot;概念&quot;&gt;&lt;/a&gt;概念&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;每个&lt;code&gt;Observable&lt;/code&gt;实例都是一个sequence.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Observable&lt;/code&gt; sequence 的关键点在 &lt;code&gt;SequenceType&lt;/code&gt; ， 而且它可以异步获取元素 。 这个是&lt;em&gt;RxSwift&lt;/em&gt;的根本，其他的都是建立在这个概念之上的。&lt;br&gt;
    
    </summary>
    
      <category term="RxSwift" scheme="http://yoursite.com/categories/RxSwift/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
      <category term="RxSwift" scheme="http://yoursite.com/tags/RxSwift/"/>
    
      <category term="Swift" scheme="http://yoursite.com/tags/Swift/"/>
    
  </entry>
  
</feed>
